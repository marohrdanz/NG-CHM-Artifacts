(function(){function r(a,b,c,e,f,g){f=f||[];Array.isArray(f)||(f=[f]);if(2<b.length)throw console.log({m:"UTIL.decorateElement: too many ids",spec,attrs:e,names:b}),Error("UTIL.decorateElement: too many ids");for(1<b.length&&a.setAttribute("id",b[1]);0<c.length;)a.classList.add(c.shift());for(e&&Object.entries(e).forEach(([h,k])=>{"style"===h?Object.entries(k).forEach(([n,m])=>{a.style[n]=m}):"dataset"===h?Object.entries(k).forEach(([n,m])=>{a.dataset[n]=m}):a.setAttribute(h,k)});0<f.length;)if(b=
f.shift(),"string"==typeof b)for(c=document.createElement("div"),c.innerHTML=b;c.firstChild;)a.appendChild(c.firstChild);else a.appendChild(b);if(g){f=g(a);if(f instanceof HTMLElement)return f;console.error(Error("UTIL.decorateElement decorator function did not return a DOM node"))}return a}NgChm.markFile();const d=NgChm.createNS("NgChm.UTIL"),u=NgChm.importNS("NgChm.CFG");d.getURLParameter=function(a){return decodeURIComponent(((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)")).exec(location.search)||
[,""])[1].replace(/\+/g,"%20"))||""};d.mapId=d.getURLParameter("map");d.mapNameRef=d.getURLParameter("name");d.capitalize=function(a){return a.substr(0,1).toUpperCase()+a.substr(1)};(function(){d.passiveCompat=function(){var a=!1;const b=function(){};try{var c=Object.defineProperty({},"passive",{get(){a=!0}});window.addEventListener("test",b,c);window.removeEventListener("test",b,c)}catch(e){}return a}()?a=>a:a=>!!a.capture})();const t=new Map;d.setKeyData=function(a,b){t.set(a,b)};d.getKeyData=function(a){return t.get(a)};
d.setKeyData("web-builder-url",u.builder_url);d.addScript=function(a,b){const c=document.getElementsByTagName("head")[0];a=d.newElement("script",{type:"text/javascript",src:a});c.appendChild(a);a.onload=b;a.onreadystatechange=function(){"complete"==this.readyState&&b()}};d.addScripts=function(a,b){d.addScript(a[0],()=>{1===a.length?b():d.addScripts(a.slice(1),b)})};d.setElementPositionSize=function(a,b,c){a&&a.style||console.error("setElementPositionSize on non-element",a);b.left&&(a.style.left=b.left+
"px");b.top&&(a.style.top=b.top+"px");a.style.width=b.width+"px";a.style.height=b.height+"px";c||"CANVAS"!==a.tagName||(a.width=Math.round(b.width),a.height=Math.round(b.height))};d.newTxt=function(a){return document.createTextNode(a)};d.newSvgButton=function(a,b,c){a=a.split(".");const e=a.shift().split("#"),f=e[0].split("!"),g=d.newElement("BUTTON");g.innerHTML=f.map(h=>'<SVG width="1em" height="1em"><USE href="icons.svg#'+h+'"/></SVG>').join("");return r(g,e,a,b,[],c)};d.newSvgMenuItem=function(a,
b,c){a=a.split(".");const e=a.shift().split("#"),f=e[0].split("!"),g=d.newElement("DIV.menuSvg");g.innerHTML=f.map(h=>'<SVG width="1em" height="1em"><USE href="icons.svg#'+h+'"/></SVG>').join("");return r(g,e,a,b,[],c)};d.newElement=function(a,b,c,e){a=a.split(".");const f=a.shift().split("#"),g=document.createElement(f[0]);return r(g,f,a,b,c,e)};d.newFragment=function(a){const b=document.createDocumentFragment();a.forEach(c=>{b.appendChild(c)});return b};d.newButton=function(a,b,c){a=d.newElement("SPAN.button",
{},[d.newTxt(a)]);for(const e of Object.entries(c))a.addEventListener(e[0],e[1]);return a};d.showTab=function(a){const b=document.getElementById(a);b||console.error("No tab button identified by buttonId:",{buttonId:a});(function(e){[...e.children].forEach(f=>{const g=document.getElementById(f.dataset.forTab);g||console.error("No tab identified by button:",{btn:f});g.classList.add("hide");f.classList.remove("selected")})})(b.parentElement);const c=b.dataset.forTab&&document.getElementById(b.dataset.forTab);
c||console.error("No tab identified by buttonId:",{buttonId:a});c.classList.remove("hide");b.classList.add("selected")};d.toTitleCase=function(a){return a.toLowerCase().replace(/_/g," ").replace(/\b([a-z\u00C0-\u00ff])/g,function(b,c){return c.toUpperCase()}).replace(/(\s(?:de|a|o|e|da|do|em|ou|[\u00C0-\u00ff]))\b/ig,function(b,c){return c.toLowerCase()})};d.getStyle=function(a,b){if(a.currentStyle)var c=a.currentStyle[b];else window.getComputedStyle&&(c=document.defaultView.getComputedStyle(a,null).getPropertyValue(b));
return c};d.returnToHome=function(){var a=d.getURLParameter("collectionHome");""!==a&&window.open(a,"_self")};d.reverseObject=function(a){var b=[],c=[],e;for(e in a)b.push(e);for(a=b.length-1;0<=a;a--)c[b[a]]=[];return c};d.isScreenZoomed=function(){var a=0;.89>window.devicePixelRatio?a=-1:1.375<window.devicePixelRatio&&(a=1);return a};d.getBrowserType=function(){var a="unknown";if(-1!=(navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR")))a="Opera";else if(-1!=navigator.userAgent.indexOf("Chrome"))a=
"Chrome";else if(-1!=navigator.userAgent.indexOf("Safari"))a="Safari";else if(-1!=navigator.userAgent.indexOf("Firefox"))a="Firefox";else if(-1!=navigator.userAgent.indexOf("MSIE")||1==!!document.documentMode)a="IE";return a};d.minLabelSize=5;d.showSummaryPane=!0;d.showDetailPane=!0;d.blendTwoColors=function(a,b){b=b||"#ffffff";a=(a||"#000000").substring(1);b=b.substring(1);a=[parseInt(a[0]+a[1],16),parseInt(a[2]+a[3],16),parseInt(a[4]+a[5],16)];b=[parseInt(b[0]+b[1],16),parseInt(b[2]+b[3],16),parseInt(b[4]+
b[5],16)];a=[.5*a[0]+.5*b[0],.5*a[1]+.5*b[1],.5*a[2]+.5*b[2]];return a="#"+d.intToHex(a[0])+d.intToHex(a[1])+d.intToHex(a[2])};d.intToHex=function(a){a=Math.round(a).toString(16);1==a.length&&(a="0"+a);return a};d.convertToArray=function(a){var b=[];b.push(a);return b};d.isBuilderView=!1;d.containerElement=document.getElementById("ngChmContainer");d.removeElementsByClass=function(a){for(a=document.getElementsByClassName(a);0<a.length;)a[0].parentNode.removeChild(a[0])};d.shadeColor=function(a,b){var c=
b/100;b=parseInt(a.slice(1),16);a=0>c?0:255;c=0>c?-1*c:c;var e=b>>16,f=b>>8&255;b&=255;return"#"+(16777216+65536*(Math.round((a-e)*c)+e)+256*(Math.round((a-f)*c)+f)+(Math.round((a-b)*c)+b)).toString(16).slice(1)};d.imageCanvas=function(a){let b=document.createElement("canvas");const c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0);return b};d.isNaN=function(a){let b;b=isNaN(a);""===a.trim()&&(b=!0);return b};d.isValidURL=function(a){try{new URL(a)}catch(b){return!1}return!0};
d.dragElement=function(a){function b(l){l=l||window.event;l.preventDefault();const q=a.getBoundingClientRect();g=l.clientX-q.x;h=l.clientY-q.y;n=-q.width/2;m=window.innerWidth-q.width/2;l=p.getBoundingClientRect();k=window.innerHeight-l.height;document.onmouseup=e;document.onmousemove=c}function c(l){l=l||window.event;l.preventDefault();const q=l.clientY-h;a.style.left=Math.min(m,Math.max(n,l.clientX-g))+"px";a.style.top=Math.min(k,Math.max(-2,q))+"px";l=document.getElementById("content").clientHeight;
a.style.height="";a.offsetHeight>f+l&&(a.style.height=f+l+"px")}function e(){document.onmouseup=null;document.onmousemove=null}const f=document.getElementById("mdaServiceHeader").clientHeight;let g=0,h=0,k=0,n=0,m=0;const p=document.getElementById(a.id+"Hdr")||a.querySelector(".msgBoxHdr");p&&(p.onmousedown=b)};d.roundUpDown=function(a,b){var c=a,e=a%10;5===b?c=5>e&&3<=e||5<e&&7<=e?5*Math.ceil(a/5):5*Math.floor(a/5):10===b&&(c=5<=e?10*Math.ceil(a/10):10*Math.floor(a/10));return c};d.createCheckBoxDropDown=
function(a,b,c,e,f){function g(k){d.toggleCheckBox(k,k.target)}b=document.getElementById(b);var h=document.getElementById(a);a=[];for(let k=0;k<e.length;k++)a.push(e[k]);a.sort((k,n)=>k.localeCompare(n,void 0,{sensitivity:"base"}));h.innerHTML="<select><option>"+c+"</option></select><div id='overSelect' class='dropDownOverSelect'></div>";c="";for(h=0;h<a.length;h++)c=c+"<label for='"+a[h]+"' ><input type='checkBox' class='srchCovCheckBox' value='"+a[h]+"' name='"+a[h]+"'>"+a[h]+"</input></label>";
b.style.height=20<e.length?f:18*(e.length+1)+"px";b.innerHTML=c+"<label for='Missing'><input type='checkBox' class='srchCovCheckBox' value='missing' name='missing'>Missing</input></label>";b.querySelectorAll("label").forEach(k=>{k.onclick=g})};d.clearCheckBoxDropdown=function(a){document.getElementById(a).innerHTML=""};d.resetCheckBoxDropdown=function(a){a=document.getElementsByClassName(a);for(var b=0;b<a.length;b++)a[b].checked=!1};d.toggleCheckBox=function(a,b){"LABEL"===a.target.nodeName&&(b.children[0].checked=
!b.children[0].checked)};d.showCheckBoxDropDown=function(a){a=document.getElementById(a);a.style.display="none"===a.style.display?"block":"none"};d.closeCheckBoxDropdown=function(a,b){null!==document.getElementById(b).offsetParent&&document.getElementById(a).click()};d.keepElementInViewport=function(a){a=document.getElementById(a);if(null!==a){const b=a.getBoundingClientRect();b.bottom<window.innerHeight&&a.style.height&&(a.style.height="");b.bottom>window.innerHeight&&(a.style.height=window.innerHeight-
b.top+"px");b.right>window.innerWidth&&(a.style.left=window.innerWidth-b.width+"px");0>b.top&&(a.style.top="0px");0>b.left&&(a.style.left="0px")}};d.embedLoaded=!1;d.embedThumbWidth="150px";d.embedThumbHeight="150px";d.defaultNgchmWidget="ngchmWidget-min.js";d.setNgchmWidget=function(a){d.defaultNgchmWidget=a};d.embedExpandableMap=function(a){if(void 0!==a.ngchm){void 0===a.divId&&(a.divId="NGCHM");void 0===a.thumbnail&&(a.thumbnail=a.ngchm.replace(/\.ngchm$/,".png"));void 0===a.thumbnailWidth&&(a.thumbnailWidth=
"150px");void 0===a.thumbnailHeight&&(a.thumbnailHeight=a.thumbnailWidth);void 0===a.ngchmWidget&&(a.ngchmWidget=d.defaultNgchmWidget);var b=void 0===a.displayWidth?"100":a.displayWidth.substring(0,a.displayWidth.length-1),c=void 0===a.customJS?"":a.customJS,e=b;70>=b&&(e=70);d.embedThumbWidth=a.thumbnailHeight;var f=document.getElementById(a.divId),g=document.createElement("iframe");g.id=a.divId+"_iframe";g.scrolling="no";g.style="height:"+a.thumbnailHeight+"; width:100%; border-style:none; ";g.sandbox=
"allow-scripts allow-same-origin allow-popups allow-forms allow-modals allow-downloads";g.className="ngchmThumbnail";f.appendChild(g);f=g.contentWindow.document;f.open();f.write("<!DOCTYPE html><HTML><BODY style='margin:0px;width:100vw;height: 100vh;display: flex;flex-direction: column;'><div id='NGCHMEmbedWrapper' class='NGCHMEmbedWrapper' style='height: "+a.thumbnailHeight+"; width: "+a.thumbnailWidth+"'><img img id='NGCHMEmbedButton' src='"+a.thumbnail+"' alt='Show Heat Map' onclick='NgChm.API.showEmbed(this,\""+
b+'","'+e+'","'+c+"\");' /><div class='NGCHMEmbedOverlay' onclick='NgChm.UTIL.showEmbed(this,\""+b+'","'+e+'","'+c+"\");' ><div id='NGCHMEmbedOverText'>Expand<br>Map</div></div></div><div id='NGCHMEmbedCollapse' style='display: none;width: 100px; height: 20px;'><div class='buttonGroup'><button id='NGCHMEmbedButton' onclick='NgChm.API.hideEmbed();'><span class='button'>Collapse Map</span></button></div></div><br/><div id='NGCHMEmbed' style='display: none; background-color: white; height: 100%; width: 98%; border: 2px solid gray; padding: 5px;'></div><script src='"+
a.ngchmWidget+"'>\x3c/script><script type='text/Javascript'>NgChm.API.embedCHM('"+a.ngchm+"');\x3c/script></BODY></HTML><br><br>");f.close()}};d.defaultNgchmWidget="ngchmWidget-min.js";d.b64toBlob=function(a){a=atob(a);let b=[];for(var c=0;c<a.length;c+=512){const f=a.slice(c,c+512);let g=Array(f.length);for(var e=0;e<f.length;e++)g[e]=f.charCodeAt(e);e=new Uint8Array(g);b.push(e)}return new Blob(b)};d.getClickType=function(a){var b=0;a=a||window.event;a.which||"undefined"===typeof a.button||(a.which=
a.button&1?1:a.button&2?3:a.button&4?2:0);switch(a.which){case 3:b=1}a.ctrlKey&&(b=1);return b};d.getCursorPosition=function(a){if(a.touches)if(0<a.touches.length){var b=a.target.getBoundingClientRect();var c=Math.round(a.targetTouches[0].pageX-b.left);a=Math.round(a.targetTouches[0].pageY-b.top)}else b=a.target.getBoundingClientRect(),c=Math.round(a.changedTouches[0].pageX-b.left),a=Math.round(a.changedTouches[0].pageY-b.top);else c=a.offsetX,a=a.offsetY;return{x:c,y:a}};d.hexToComplimentary=function(a){var b=
"rgb("+(a=a.replace("#","")).match(new RegExp("(.{"+a.length/3+"})","g")).map(function(m){return parseInt(a.length%2?m+m:m,16)}).join(",")+")";b=b.replace(/[^\d,]/g,"").split(",");var c=b[0],e=b[1],f=b[2];c/=255;e/=255;f/=255;var g=Math.max(c,e,f),h=Math.min(c,e,f);b=(g+h)/2;if(g==h)var k=h=0;else{var n=g-h;h=.5<b?n/(2-g-h):n/(g+h);g==c&&e>=f?k=1.0472*(e-f)/n:g==c&&e<f?k=1.0472*(e-f)/n+6.2832:g==e?k=1.0472*(f-c)/n+2.0944:g==f&&(k=1.0472*(c-e)/n+4.1888)}k=k/6.2832*360+45;360<k&&(k-=360);k/=360;0===
h?c=e=f=b:(f=function(m,p,l){0>l&&(l+=1);1<l&&--l;return l<1/6?m+6*(p-m)*l:.5>l?p:l<2/3?m+(p-m)*(2/3-l)*6:m},g=.5>b?b*(1+h):b+h-b*h,b=2*b-g,c=f(b,g,k+1/3),e=f(b,g,k),f=f(b,g,k-1/3));c=Math.round(255*c);e=Math.round(255*e);f=Math.round(255*f);return"#"+(16777216|f|e<<8|c<<16).toString(16).substring(1)};d.getContigRanges=function(a){const b=[];let c=a[0],e=a[0];if(0<a.length)for(let f=0;f<a.length;f++){let g=a[f];1<g-c?(b.push([e,c]),e=g,f===a.length-1&&b.push([g,g])):f===a.length-1&&b.push([e,g]);
c=g}return b};(function(){NgChm.exportToNS("NgChm.UTIL",{showSplashExample:function(){const c=document.getElementById("splashWaiting");if(c){var e=document.getElementById("splashExample");c.classList.add("hide");e.classList.remove("hide")}},showLoader:function(c){const e=document.getElementById("splash"),f=document.getElementById("loader");b+="<P>"+c;f.innerHTML=b;a&&(f.classList.replace("faded","fadeinslow"),e&&e.classList.replace("fadeinslow","fadeout"),a=!1)},hideLoader:function(c){document.getElementById("loader").classList.replace("fadeinslow",
"fadeout");c&&([...document.querySelectorAll("*[data-hide-on-load]")].forEach(e=>e.classList.add("hide")),d.containerElement.classList.replace("faded","fadein"),[...document.querySelectorAll("*[data-show-on-load]")].forEach(e=>e.classList.remove("hide")))}});var a=!0,b=""})();(function(){String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return this.substr(b||0,a.length)===a});Element.prototype.remove||(Element.prototype.remove=function(){this.parentElement.removeChild(this)})})();
(function(){var a=0,b=document.createElement("div");b.innerHTML="<div><p>a b c d e f g h i j k l m n o p q r s t u v w x y z</p></div>";b.style.position="absolute";b.style.fontSize="1px";b.style.width="64px";document.body.appendChild(b);for(var c=b.offsetHeight,e=0,f=64,g,h=0;32>h&&5<=f;++h)g=(e+f)/2,b.style.fontSize=g+"px",b.offsetHeight===c?e=g:f=g;5<g&&(a=g,d.minLabelSize=Math.floor(g)-1);document.body.removeChild(b);return a})();(function(){let a=!1;"IE"===d.getBrowserType()&&(a=!0);5<d.minLabelSize&&
(a=!0);const b=document.getElementById("messageOpen_btn");void 0!=b&&(b.style.display=a?"":"none")})();document.getElementById("srchCovSelectBox").onclick=function(a){d.showCheckBoxDropDown("srchCovCheckBoxes")}})();
(function(){NgChm.markFile();const e=NgChm.createNS("NgChm.CM"),m=NgChm.importNS("NgChm.UTIL");e.jsonConfigStr='{"row_configuration": {"classifications": {"show": "Y","height": 15,"bar_type": "color_plot","fg_color": "#000000","bg_color": "#FFFFFF","low_bound": "0","high_bound": "100"},"classifications_order": 1,"organization": {"agglomeration_method": "unknown","order_method": "unknown","distance_metric": "unknown"},"dendrogram": {"show": "ALL","height": "100"},"label_display_length": "20","label_display_method": "END","top_items": "[]"},"col_configuration": {"classifications": {"show": "Y","height": 15,"bar_type": "color_plot","fg_color": "#000000","bg_color": "#FFFFFF","low_bound": "0","high_bound": "100"},"classifications_order": 1,"organization": {"agglomeration_method": "unknown","order_method": "unknown","distance_metric": "unknown"},"dendrogram": {"show": "ALL","height": "100"},"label_display_length": "20","label_display_method": "END","top_items": "[]"},"data_configuration": {"map_information": {"data_layer": {"name": "Data Layer","grid_show": "Y","grid_color": "#FFFFFF","selection_color": "#00FF38","cuts_color": "#FFFFFF"},"name": "CHM Name","description": "Full length description of this heatmap","summary_width": "50","builder_version": "NA","summary_height": "100","detail_width": "50","detail_height": "100","read_only": "N","version_id": "1.0.0","map_cut_rows": "0","map_cut_cols": "0"}}}';
e.version="2.24.1";e.versionCheckUrl="https://bioinformatics.mdanderson.org/versioncheck/NGCHM/";e.viewerAppUrl="https://bioinformatics.mdanderson.org/ngchm/ZipAppDownload";e.classOrderStr=".classifications_order";e.CompatibilityManager=function(a){var b=!1,f=JSON.parse(e.jsonConfigStr),h={};e.buildConfigComparisonObject(f,"",h,a);f={};e.buildConfigComparisonObject(a,"",f);for(var d in h){var c=d,g=!1;c.includes(e.classOrderStr)&&(c+=".0",g=!0);var k=h[d],l=!1;for(d in f)if(d===c){l=!0;break}if(!l)if(g)e.hasClasses(a,
c)&&(b=!0);else{g=c.substring(1,c.lastIndexOf("."));b=c.substring(c.lastIndexOf(".")+1,c.length);c=g.split(".");"classifications"===c[1]&&(c[2]=e.trimClassLabel(c));g=a;for(l=0;l<c.length;l++)g=g[c[l]];"[]"==k&&(k=[]);g[b]=k;b=!0}}return b};e.trimClassLabel=function(a){if(3<a.length){for(var b="",f=a.length-1;3<=f;f--)b="."+a[f]+b,a.splice(f,1);a=a[2]+b}else a=a[2];return a};e.hasClasses=function(a,b){if(b.includes(".row_configuration.")){if(0<Object.keys(a.row_configuration.classifications).length)return!0}else if(0<
Object.keys(a.col_configuration.classifications).length)return!0;return!1};e.buildConfigComparisonObject=function(a,b,f,h){for(var d in a)if(a.hasOwnProperty(d))if("object"==typeof a[d])"undefined"===typeof h&&"top_items"===d?f[b+"."+d]=a[d]:e.buildConfigComparisonObject(a[d],b+"."+d,f,h);else{var c=b+"."+d;if("undefined"!==typeof h)if(-1<b.indexOf("row_configuration.classifications")){c=h.row_configuration.classifications;for(let g in c)f[b+"."+g+"."+d]=a[d]}else if(-1<b.indexOf("col_configuration.classifications")){c=
h.col_configuration.classifications;for(let g in c)f[b+"."+g+"."+d]=a[d]}else if(-1<b.indexOf("data_layer")){c=h.data_configuration.map_information.data_layer;for(let g in c){c=b+"."+g+"."+d;let k=a[d];"name"===d&&(k=k+" "+g);f[c]=k}}else f[c]=a[d];else f[c]=a[d]}};e.mapDataCompatibility=function(a){var b=!1;Array.isArray(a.col_data.label.label_type)||(b=m.convertToArray(a.col_data.label.label_type),a.col_data.label.label_type=b,b=!0);Array.isArray(a.row_data.label.label_type)||(b=m.convertToArray(a.row_data.label.label_type),
a.row_data.label.label_type=b,b=!0);return b}})();
(function(){function m(){return"flickUp"===f.dataset.state}function g(a){var b=f.dataset.state;let c=("flickUp"===b?d.value:e.value)||"dl1",h=!1;"toggle"===a?(a="flickUp"===b?"flick2":"flick1",b=n(a),c!==b&&(c=b,h=!0)):"flick1"===a&&"flickUp"===b?h=!0:"flick2"===a&&"flickDown"===b?h=!0:c=("flick1"===a?d.value:e.value)||"dl1";return{flickElement:a,layer:c,redrawRequired:h}}function n(a){f.dataset.state="flick1"===a?"flickUp":"flickDown";return("flick1"===a?d.value:e.value)||"dl1"}NgChm.markFile();
NgChm.createNS("NgChm.FLICK",{enableFlicks:function(a,b,c){d.innerHTML=b;e.innerHTML=b;f.dataset.state="flickUp"==c.flick_btn_state||"flickDown"==c.flick_btn_state?c.flick_btn_state:"flickUp";d.value=a.includes(c.flick1)?c.flick1:a[0];a.includes(c.flick2)?e.value=c.flick2:e.value=2>a.length||a[1]==d.value?a[0]:a[1];k.style.display="";return m()?d.value:e.value},disableFlicks:function(){k.style.display="none"},flickIsOn:function(){return""===k.style.display},isFlickUp:m,getFlickState:function(){const a=
{element:"flick1",layer:d.value||"dl1"};if("none"==k.style.display)return[a];const b={element:"flick2",layer:e.value};return"flickUp"===f.dataset.state?[a,b]:[b,a]},setFlickState:n,toggleFlickState:g,setFlickHandler:function(a){document.getElementById("flick_btn").onclick=function(b){a(g("toggle"))};document.getElementById("flick1").onchange=function(b){a(g("flick1"))};document.getElementById("flick2").onchange=function(b){a(g("flick2"))}},getFlickSaveState:function(){return{flick_btn_state:f.dataset.state,
flick1:d.value,flick2:e.value}}});const k=document.getElementById("layer_control"),l=document.getElementById("layers_open_close");document.getElementById("flick_btn");const f=document.getElementById("flickViews"),d=document.getElementById("flick1"),e=document.getElementById("flick2");l.onclick=function(a){"closed"==l.dataset.state?(d.selectedIndex===e.selectedIndex&&(e.selectedIndex=0===d.selectedIndex?1:0),f.style.display="",l.dataset.state="open"):(f.style.display="none",l.dataset.state="closed")}})();
(function(){function r(a,c,d,e,f){"function"==typeof e&&(f=e,e="missing - deprecated");const g=a.querySelector(".msgBoxButtons"),h=document.createElement("button");h.id="msgBoxBtn_"+c;"object"!=typeof d&&(d={type:"image",src:d});"image"==d.type?(c=document.createElement("img"),c.src=d.src,c.alt=d.alt||e,h.appendChild(c)):(e=k.newElement("span.button"),e.innerText=d.text,c=k.newElement("span.spanbuttonwrapper"),c.appendChild(e),h.appendChild(c));d.default&&h.classList.add("default");d.disabled?(h.disabled=
!0,h.dataset.tooltip=(d.tooltip?d.tooltip+". ":"")+"Disabled because "+(d.disabledReason||"of unspecified reason")):d.tooltip&&(h.dataset.tooltip=d.tooltip+".");h.onclick=void 0==f?()=>{a==document.getElementById("msgBox")?b.messageBoxCancel():document.body.removeChild(a)}:function(l){d.disableOnClick&&(h.disabled=!0);f(h)};g.appendChild(h)}NgChm.markFile();const b=NgChm.createNS("NgChm.UHM"),k=NgChm.importNS("NgChm.UTIL");b.postMapDetails=!1;b.postMapToWhom=null;b.myNonce="N";var n=null,p=null;(function(){document.getElementById("messageOpen_btn").onclick=
()=>{b.displayStartupWarnings()}})();(function(){function a(c){let d=c;for(;d;){if("button"==d.tagName.toLowerCase()||d.dataset.hasOwnProperty("tooltip")||d.dataset.hasOwnProperty("title"))return d;d=d.parentElement}return c}document.addEventListener("mouseover",function(c){c=a(c.target);c.dataset.hovering="";if(c.dataset.tooltip){let d=c.dataset.tooltip;c.disabled&&c.dataset.disabledReason&&(d+=" "+c.dataset.disabledReason);b.hlp(c,d,140,0)}},{passive:!0});document.addEventListener("mouseout",function(c){delete a(c.target).dataset.hovering},
{passive:!0});document.addEventListener("click",function(c){b.hlpC();b.closeMenu();[...document.getElementsByClassName("remove-on-click")].forEach(d=>{d.remove()})},{passive:!0})})();b.processMessage=function(a){""===b.myNonce&&(b.myNonce=k.getURLParameter("nonce"));""!==b.myNonce&&a.data&&a.data.nonce===b.myNonce&&("ShowMapDetail"===a.data.override&&(b.postMapDetails=!0,b.postMapToWhom=a.origin),null!=a.data.ngchm_id&&(b.postID=a.data.ngchm_id))};window.addEventListener("message",b.processMessage,
!1);b.formatMapDetails=function(a,c){a.insertRow().innerHTML=b.formatBlankRow();b.setTableRow(a,["<u>Data Details</u>","&nbsp;"],2);b.setTableRow(a,["&nbsp;Value:",c.value]);b.setTableRow(a,["&nbsp;Row:",c.rowLabel]);b.setTableRow(a,["&nbsp;Column:",c.colLabel]);0<c.rowCovariates.length&&(a.insertRow().innerHTML=b.formatBlankRow(),b.setTableRow(a,["&nbsp;<u>Row Covariates</u>","&nbsp;"],2),c.rowCovariates.forEach(d=>{const e=20<d.name.length?d.name.substring(0,20)+"...":d.name;b.setTableRow(a,["&nbsp;&nbsp;&nbsp;"+
e+":</u>",d.value])}));0<c.colCovariates.length&&(a.insertRow().innerHTML=b.formatBlankRow(),b.setTableRow(a,["&nbsp;<u>Column Covariates</u>","&nbsp;"],2),c.colCovariates.forEach(d=>{const e=20<d.name.length?d.name.substring(0,20)+"...":d.name;b.setTableRow(a,["&nbsp;&nbsp;&nbsp;"+e+":</u>",d.value])}))};b.pasteHelpContents=function(){var a=document.getElementById("helpTable");window.open("","","width=500,height=330,resizable=1").document.write(a.innerText.replace(/(\r\n|\n|\r)/gm,"<br>"))};b.hlp=
function(a,c,d,e,f=500){a!=p&&(b.hlpC(),p=a,n=setTimeout(function(){const g=document.querySelector("body");if(g&&""==a.dataset.hovering){var h=b.getElemPosition(a),l=k.newElement("span.title",{},[k.newTxt(a.dataset.title||"")]),m=k.newElement("span.intro",{},[a.dataset.intro||c]);l=k.newElement("div#bubbleHelp",{},[l,m]);void 0!==e?(m=h.left-d,0>m&&(m=0),l.style.left=m+"px"):l.style.left=h.left+"px";l.style.top=h.top+40+"px";l.innerHTML="<b><font size='2' color='#0843c1'>"+c+"</font></b>";l.style.display=
"inherit";g.appendChild(l);n=null;setTimeout(()=>{p==a&&(p=null,b.hlpC())},5E3)}},f))};b.getElemPosition=function(a){for(var c=0,d=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft-a.scrollLeft,d+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:d,left:c}};b.hlpC=function(){null!==n&&(clearTimeout(n),p=n=null);let a=document.getElementById("bubbleHelp");null===a&&(a=document.getElementById("helptext"));a&&a.remove()};b.getDivElement=function(a){var c=document.createElement("div");
c.id=a;c.style.backgroundColor="#CBDBF6";c.style.display="none";return c};b.setTableRow=function(a,c,d,e){a=a.insertRow();a.className="chmTblRow";for(var f=0;f<c.length;f++){var g=a.insertCell(f);"undefined"!=typeof d&&(g.colSpan=d);0===f&&(g.style.fontWeight="bold");["string","number"].includes(typeof c[f])||Array.isArray(c[f])?g.innerHTML=c[f]:c[f]&&g.appendChild(c[f]);"undefined"!=typeof e&&(g.align=e)}};b.setTableRowX=function(a,c,d,e){d=d||[];e=e||Array(c.length);const f=a.insertRow();f.classList.add("chmTblRow");
d.forEach(g=>{f.classList.add(g)});1==f.classList.length&&f.classList.add("entry");for(a=0;a<c.length;a++){const g=f.insertCell(a);for(let [h,l]of Object.entries(e[a]||{}))if("object"!=typeof l)g[h]=l;else if("style"==h)for(let [m,q]of Object.entries(l))g.style[m]=q;else if("classList"==h)l.forEach(m=>g.classList.add(m));else if("dataset"==h)for(let [m,q]of Object.entries(l))g.dataset[m]=q;else console.error("Unknown object in tdProps: "+h);0==g.classList.length&&g.classList.add(0==a?"label":"value");
["string","number"].includes(typeof c[a])||Array.isArray(c[a])?g.innerHTML=c[a]:c[a]&&g.appendChild(c[a])}};b.formatBlankRow=function(){return"<td style='line-height:4px;' colspan=2>&nbsp;</td>"};b.addBlankRow=function(a,c){a.insertRow().innerHTML=b.formatBlankRow();if("undefined"!==typeof c)for(var d=1;d<c;d++)a.insertRow().innerHTML=b.formatBlankRow()};b.hamburgerLinkMissing=function(){b.initMessageBox();b.setMessageBoxHeader("NG-CHM Menu Link Error");b.setMessageBoxText("<br>No destination has been defined for the menu link.");
b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.systemMessage=function(a,c){b.initMessageBox();b.setMessageBoxHeader(a);b.setMessageBoxText("<br>"+c);b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.noWebGlContext=function(a){b.initMessageBox();b.setMessageBoxHeader("ERROR: WebGL Initialization Failed");a?b.setMessageBoxText("<br>WebGL is available but is not enabled on your machine.  The NG-CHM Application requires the WebGL Javascript API in order to render images of Next Generation Clustered Heat Maps.<br><br>Instructions for enabling WebGL, based on browser type, can be found via a web search."):
b.setMessageBoxText("<br>No WebGL context is available.  The NG-CHM Application requires the WebGL Javascript API in order to render images of Next Generation Clustered Heat Maps. Most web browsers and graphics processors support WebGL.<br><br>Please ensure that the browser that you are using and your computer's processor are WebGL compatible.");b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.mapNotFound=function(a){k.hideLoader(!1);
b.initMessageBox();b.setMessageBoxHeader("Requested Heat Map Not Found");b.setMessageBoxText("<br>The Heat Map ("+a+") that you requested cannot be found OR connectivity to the Heat Map repository has been interrupted.<br><br>Please check the Heat Map name and try again.");b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.mapLoadError=function(a,c){k.hideLoader(!1);b.initMessageBox();b.setMessageBoxHeader("Requested Heat Map Not Loaded");
b.setMessageBoxText("<br>The Heat Map ("+a+") that you selected cannot be loaded.<br><br>Reason: "+c);b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.linkoutError=function(a){b.initMessageBox();b.setMessageBoxHeader("Heat Map Linkout");b.setMessageBoxText(a);b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.invalidFileFormat=function(){b.initMessageBox();b.setMessageBoxHeader("Invalid File Format");
b.setMessageBoxText("<br>The file chosen is not an NG-CHM file.<br><br>Please select a .ngchm file and try again.");b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.initMessageBox=function(){b.hideMsgBoxProgressBar();const a=document.getElementById("msgBox");for(;0<a.classList.length;)a.classList.remove(a.classList[0]);a.style.display="none";a.style.width="";const c=a.querySelector(".msgBoxButtons");for(;c.firstChild;)c.removeChild(c.firstChild);
document.getElementById("messageOpen_btn").style.display="none";return a};b.messageBoxIsVisible=function(){const a=document.getElementById("msgBox");return a&&"none"!=a.style.display};b.setMessageBoxHeader=function(a){var c=document.getElementById("msgBoxHdr");c.innerHTML="<SPAN>"+a+"</SPAN>";c.querySelector(".closeX")&&c.querySelector(".closeX").remove();c.appendChild(b.createCloseX(b.messageBoxCancel))};b.getMessageTextBox=function(){return document.getElementById("msgBoxTxt")};b.setMessageBoxText=
function(a){document.getElementById("msgBoxTxt").innerHTML=a};b.displayMessageBox=function(){let a=document.getElementById("msgBox");a.style.display="";a.style.left=(window.innerWidth-a.offsetWidth)/2+"px";let c=document.getElementById("mdaServiceHeader");a.style.top=c.offsetTop+15+"px"};b.setMessageBoxButton=function(a,c,d,e){const f=document.getElementById("msgBox");r(f,a,c,d,e)};b.showMsgBoxProgressBar=function(){document.getElementById("msgBoxProgressDiv").style.display="";document.getElementById("msgBoxProgressBar").value=
0};b.hideMsgBoxProgressBar=function(){document.getElementById("msgBoxProgressDiv").style.display="none"};b.isProgressBarVisible=function(){return""==document.getElementById("msgBoxProgressDiv").style.display};b.msgBoxProgressMeter=function(a){document.getElementById("msgBoxProgressBar").value=a;return"true"!=document.getElementById("msgBoxProgressBar").dataset.cancelled};b.cancelOperation=function(){document.getElementById("msgBoxProgressBar").dataset.cancelled="true";document.getElementById("msgBoxProgressDiv").style.opacity=
.5};b.messageBoxCancel=function(){b.initMessageBox()};b.newMessageBox=function(a){a="msgBox-for-"+a;var c=document.getElementById(a);if(c)return c;c=document.querySelector("template#msgBoxTemplate").content.querySelector("div").cloneNode(!0);c.classList.add("hide");c.id=a;document.body.appendChild(c);k.dragElement(c);return c};b.setNewMessageBoxHeader=function(a,c){const d=a.querySelector(".msgBoxHdr");d.innerHTML="<SPAN>"+c+"</SPAN>";d.querySelector(".closeX")&&d.querySelector(".closeX").remove();
d.appendChild(b.createCloseX(()=>{b.closeNewMessageBox(a)}))};b.getNewMessageTextBox=function(a){return a.querySelector(".msgBoxTxt")};b.setNewMessageBoxButton=function(a,c,d,e){e||(e=()=>{b.closeNewMessageBox(a)});r(a,c,d,e)};b.displayNewMessageBox=function(a){a.classList.remove("hide")};b.closeNewMessageBox=function(a){document.body.removeChild(a)};b.closeMenu=function(){const a=document.getElementById("barMenu_btn");null===a||a.dataset.hasOwnProperty("hovering")||(document.getElementById("burgerMenuPanel").style.display=
"none")};b.displayStartupWarnings=function(){b.hlpC();b.initMessageBox();var a="NG-CHM Startup Warning",c="",d=!1,e=1;"IE"===k.getBrowserType()?c="<br><b>Unsupported Browser Warning:</b> Your current browser is Internet Explorer. The NG-CHM application is optimized for use with the Google Chrome and Mozilla Firefox browsers.  While you may view maps in IE, the performance of the application cannot be guaranteed.<br><br>You may wish to switch to one of these supported browsers.":(11<k.minLabelSize&&
(d&&(c+="<br>"),c+="<br><b>Minimum Font Warning:</b> Current browser settings include a minimum font size setting that is too large. This will block the display of row, column, and covariate bar labels in the NG-CHM application. You may wish to turn off or adjust this setting in your browser.",d=!0,e++),5<k.minLabelSize&&(d&&(c+="<br>"),c+="<br><b>Minimum Font Warning:</b> Current browser settings include a minimum font size setting. This may interfere with the display of row, column, and covariate bar labels in the NG-CHM application. You may wish to turn off or adjust this setting in your browser.",
e++));2<e&&(a+="s");b.setMessageBoxHeader(a);b.setMessageBoxText(c);b.setMessageBoxButton("cancel",{type:"text",text:"Cancel"},"Cancel button",b.messageBoxCancel);b.displayMessageBox()};b.createCloseX=function(a){const c=k.newSvgButton("icon-big-x.red");c.onclick=a;return k.newElement("SPAN.closeX",{},[c])}})();
(function(){NgChm.markFile();const a=NgChm.createNS("NgChm.MAPREP");a.maxValues=2147483647;a.minValues=-2147483647;a.THUMBNAIL_LEVEL="tn";a.SUMMARY_LEVEL="s";a.RIBBON_VERT_LEVEL="rv";a.RIBBON_HOR_LEVEL="rh";a.DETAIL_LEVEL="d"})();
(function(){function l(f){return(f=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(f))?{r:parseInt(f[1],16),g:parseInt(f[2],16),b:parseInt(f[3],16),a:255}:null}NgChm.markFile();const n=NgChm.createNS("NgChm.CMM"),u=NgChm.importNS("NgChm.MAPREP");n.ColorMap=function(f,h){function g(a,b){for(var c={},e=0;e<v;){if(b[e]<=a&&a<b[e+1]){c.upper=e+1;c.lower=e;break}e++}return c}function m(a,b,c){a=(a-c[b])/(c[b+1]-c[b]);c=k[b];b=k[b+1];const e={};e.r=Math.round(c.r*(1-a)+b.r*a);e.g=Math.round(c.g*(1-a)+
b.g*a);e.b=Math.round(c.b*(1-a)+b.b*a);e.a=255;return e}function t(a){const {r:b,g:c,b:e}=a;return"#"+p(b)+p(c)+p(e)}function p(a){a=a.toString(16);return 1==a.length?"0"+a:a}this.heatMap=f;var w=h.type;var d="quantile"==w?h.linearEquiv:h.thresholds;var v=d.length,q=h.colors,x=h.missing,k=[],r;if(void 0!=h.rgbaColors)k=h.rgbaColors;else for(f=0;f<v;f++)k[f]=l(q[f]);void 0!=h.rgbaMissingColor?rgbaMissingColors=h.rgbaMissingColor:r=l(x);this.getThresholds=function(){return d};this.setThresholds=function(a){d=
a};this.getContinuousThresholdKeys=function(){const a=[],b=d[0],c=this.getContinuousThresholdKeySize();a.push(b);for(let e=1;8>=e;e++)a.push(b+c*e);a.push(d[d.length-1]);return a};this.getContinuousThresholdKeySize=function(){return(d[d.length-1]-d[0])/9};this.getColors=function(){return q};this.setColors=function(a){q=a};this.getType=function(){return w};this.getMissingColor=function(){return x};this.setMissingColor=function(a){x=a};class z{constructor(a,b){this.minBreak=b[0];this.maxIdx=b.length-
1;this.maxBreak=b[this.maxIdx];this.thresholds=b;this.cutsColor=a.getCutsColor()}getColor(a){return"Missing"===a||isNaN(a)?r:this.contColor(+a)}contColor(a){if(a<=this.minBreak)return a<=u.minValues?this.cutsColor:k[0];if(a>=this.maxBreak)return a>=u.maxValues?r:k[this.maxIdx];let b;if(a<this.thresholds[1])b=0;else if(a<this.thresholds[2])b=1;else for(b=2;a>=this.thresholds[b+1];)b++;return m(a,b,this.thresholds)}}this.getContColorMap=function(){return new z(this,d)};this.getCutsColor=function(){const a=
this.heatMap.getDataLayers()[this.heatMap.getCurrentDL()];return"undefined"!==typeof a.cuts_color?l(a.cuts_color):{r:255,g:255,b:255,a:255}};this.getColor=function(a){if(a>=u.maxValues||"Missing"==a||isNaN(a))a=r;else if(a<=u.minValues)a=this.getCutsColor();else if(a<=d[0])a=k[0];else if(a>=d[v-1])a=k[v-1];else{const b=g(a,d);a=m(a,b.lower,d)}return a};this.getClassificationColor=function(a){if("!CUT!"==a)return{r:255,g:255,b:255,a:255};if("discrete"==w){for(var b=0;b<d.length;b++)if(a==d[b])return a=
k[b];return r}return a=isNaN(a)?r:this.getColor(a)};this.addBreakpoint=function(a,b){var c=g(a,d);d.splice(c.lower,0,a);q.splice(c.lower,0,b);k.splice(c.lower,0,l(b))};this.changeBreakpoint=function(a,b){var c=g(a,d);d.splice(c.lower,1,a);q.splice(c.lower,1,b);k.splice(c.lower,1,l(b))};this.removeBreakpoint=function(a){a=g(a,d);d.splice(a.lower,1);q.splice(a.lower,1);k.splice(a.lower,1)};this.getColorLuminance=function(a){return(a=(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],
16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null)?.2126*a.r+.7152*a.g+.0722*a.b:null};this.isColorDark=function(a){return a?60>.2126*a.r+.7152*a.g+.0722*a.b?!1:!0:!1};this.getRgbToHex=function(a){var b=a.g,c=a.b;return"#"+p(a.r)+p(b)+p(c)};n.blendHexColors=function(a,b,c){a=l(a);b=l(b);return t({r:a.r*c+b.r*(1-c)|0,g:a.g*c+b.g*(1-c)|0,b:a.b*c+b.b*(1-c)|0,a:a.a*c+b.a*(1-c)|0})};n.darkenHexColorIfNeeded=function(a){const {r:b,g:c,b:e}=l(a),y=Math.min(b,c,e);if(240>=y)return a;a=240/y;return t({r:b*
a|0,g:c*a|0,b:e*a|0})}};n.ColorMapManager=function(f){this.heatMap=f;f=f.mapConfig;const h=[f.data_configuration.map_information.data_layer,f.row_configuration.classifications,f.col_configuration.classifications];this.getColorMap=function(g,m){return new n.ColorMap(this.heatMap,h["data"===g?0:"row"===g?1:2][m].color_map)};this.setColorMap=function(g,m,t){g=h["data"===t?0:"row"===t?1:2][g].color_map;g.colors=m.getColors();g.thresholds=m.getThresholds();g.missing=m.getMissingColor()}};n.hexToRgba=l})();
(function() {
    'use strict';
    NgChm.markFile();

    const MMGR = NgChm.createNS('NgChm.MMGR');
    const CFG = NgChm.importNS('NgChm.CFG');
    const UTIL = NgChm.importNS('NgChm.UTIL');

//Create a worker thread to request/receive json data and tiles.  Using a separate
//thread allows the large I/O to overlap extended periods of heavy computation.
MMGR.createWebLoader = function (fileSrc) {

	const debug = false;
	const baseURL = getLoaderBaseURL (fileSrc);

	// Define worker script.
	// (it was seen to cause problems to include "use strict" in wS [code string passed to web worker])
let	wS = `const debug = ${debug};`;
	wS += `const maxActiveRequests = 2;`; // Maximum number of tile requests that can be in flight concurrently
	wS += `var active = 0;`;              // Number of tile requests in flight
	wS += `const pending = [];`;          // Additional tile requests
	wS += `const baseURL = "${baseURL}";`; // Base URL to prepend to requests.
	wS += `var mapId = "${UTIL.mapId}";`; // Map ID.
	wS += `const mapNameRef = "${UTIL.mapNameRef}";`; // Map name (if specified).

	// Create a function that determines the get tile request.
	// Body of function depends on the fileSrc of the NG-CHM.
	wS += 'function tileURL(job){return baseURL+';
	if (fileSrc === MMGR.WEB_SOURCE) {
		wS += '"GetTile?map=" + mapId + "&datalayer=" + job.layer + "&level=" + job.level + "&tile=" + job.tileName';
	} else {
		// [bmb] Is LOCAL_SOURCE ever used?  ".bin" files were obsoleted years ago.
		wS += 'job.layer+"/"+job.level+"/"+job.tileName+".bin"';
	}
	wS += ";}";

	// The following function is stringified and sent to the web loader.
	function loadTile (job) {
		if (active === maxActiveRequests) {
			pending.push(job);
			return;
		}
		active++;
		const req = new XMLHttpRequest();
		req.open("GET", tileURL(job), true);
		req.responseType = "arraybuffer";
		req.onreadystatechange = function () {
			if (req.readyState == req.DONE) {
				active--;
				if (pending.length > 0) {
					loadTile (pending.shift());
				}
				if (req.status != 200) {
					postMessage({ op: 'tileLoadFailed', job });
				} else {
					// Transfer buffer to main thread.
					postMessage({ op: 'tileLoaded', job, buffer: req.response }, [req.response]);
				}
			}
		};
		req.send();
	}
	wS += loadTile.toString();

	// Create a function that determines the get JSON file request.
	// Body of function depends on the fileSrc of the NG-CHM.
	wS += 'function jsonFileURL(name){return baseURL+';
	if (fileSrc === MMGR.WEB_SOURCE) {
		wS += '"GetDescriptor?map=" + mapId + "&type=" + name';
	} else {
		wS += 'name+".json"';
	}
	wS += ";}";

	// The following function is stringified and sent to the web loader.
	function loadJson (name) {
		const req = new XMLHttpRequest();
		req.open("GET", jsonFileURL(name), true);
		req.responseType = "json";
		req.onreadystatechange = function () {
			if (req.readyState == req.DONE) {
				if (req.status != 200) {
					postMessage({ op: 'jsonLoadFailed', name });
				} else {
					// Send json to main thread.
					postMessage({ op:'jsonLoaded', name, json: req.response });
				}
			}
		};
		req.send();
	};
	wS += loadJson.toString();

	// This function will be stringified and sent to the web loader.
	function handleMessage(e) {
		if (debug) console.log({ m: 'Worker: got message', e, t: performance.now() });
		if (e.data.op === 'loadTile') { loadTile (e.data.job); }
		else if (e.data.op === 'loadJSON') { loadJson (e.data.name); }
	}
	wS += handleMessage.toString();

	// This function will be stringified and sent to the web loader.
	function getConfigAndData() {
		// Retrieve all map configuration data.
		loadJson('mapConfig');
		// Retrieve all map supporting data (e.g. labels, dendros) from JSON.
		loadJson('mapData');
	}
	wS += getConfigAndData.toString();

	// If the map was specified by name, send the code to find the
	// map's id by name.  Otherwise just get the map's config
	// and data.
	if (UTIL.mapId === '' && UTIL.mapNameRef !== '') {
		function getMapId () {
			fetch (baseURL + "GetMapByName/" + mapNameRef)
			.then (res => {
				if (res.status === 200) {
					res.json().then (mapinfo => {
						mapId = mapinfo.data.id;
						getConfigAndData();
					});
				} else {
					postMessage({ op: 'jsonLoadFailed', name: 'GetMapByName' });
				}
			});
		}
		wS += getMapId.toString();
		wS += getMapId.name + '();';
	} else {
		wS += getConfigAndData.name + '();';
	}

	wS += `onmessage = ${handleMessage.name};`;
	if (debug) wS += `console.log ({ m:'TileLoader loaded', t: performance.now() });`;

	// Create blob and start worker.
	const blob = new Blob([wS], {type: 'application/javascript'});
	if (debug) console.log({ m: 'MMGR.createWebLoader', blob, wS });
	MMGR.webLoader = new Worker(URL.createObjectURL(blob));
	// It is possible for the web worker to post a reply to the main thread
	// before the message handler is defined.  Stash any such messages away
	// and play them back once it has been.
	const pendingMessages = [];
	MMGR.webLoader.onmessage = function(e) {
		pendingMessages.push(e);
	};
	MMGR.webLoader.setMessageHandler = function (mh) {
		// Run asychronously so that the heatmap can be defined before processing messages.
		setTimeout(function() {
		    while (pendingMessages.length > 0) {
			    mh (pendingMessages.shift());
		    }
		    MMGR.webLoader.onmessage = mh;
		}, 0);
	};

	// Called locally.
	function getLoaderBaseURL (fileSrc) {
		var URL;
		if (fileSrc == MMGR.WEB_SOURCE) {
			// Because a tile worker thread doesn't share our origin, we have to pass it
			// an absolute URL, and to substitute in the CFG.api variable, we want to
			// build the URL using the same logic as a browser for relative vs. absolute
			// paths.
			URL = document.location.origin;
			if (CFG.api[0] !== '/') {	// absolute
				URL += '/' + window.location.pathname.substr(1, window.location.pathname.lastIndexOf('/'));
			}
			URL += CFG.api;
		} else {
			console.log (`getLoaderBaseURL: fileSrc==${fileSrc}`);
			URL = MMGR.localRepository+"/"+MMGR.embeddedMapName+"/";
		}
		return URL;
	}
};

})();
(function(){function H(a,b,c){const d=document.createElement("form");d.action=b;d.method=a;c&&(a=document.createElement("textarea"),a.name="configData",a.id="configData",a.value=c,d.appendChild(a));d.style.display="none";document.body.appendChild(d);d.submit()}function N(a,b,c){const d={mapConfig:b,mapData:c};h.webLoader.setMessageHandler(function(e){if("tileLoaded"===e.data.op){const g=new Float32Array(e.data.buffer);a.tileRequestComplete(e.data.job.tileCacheName,g)}else if("tileLoadFailed"===e.data.op)a.tileRequestComplete(e.data.job.tileCacheName,
null);else if("jsonLoaded"===e.data.op)if(d.hasOwnProperty(e.data.name))d[e.data.name](a,e.data.json);else console.log({m:"connectWebLoader: unknown JSON request",e});else"jsonLoadFailed"===e.data.op?(console.error(`Failed to get JSON file ${e.data.name} for ${a.mapName} from server`),q.mapNotFound(a.mapName)):console.log({m:"connectWebLoader: unknown op",e})})}function v(a){return a&&"row"===a.toLowerCase()}function f(a,b,c,d,e){this.unAppliedChanges=this.initialized=!1;this.mapName=a;this.mapData=
this.mapConfig=null;this.datalevels={};this.alternateLevels={};this.colorMapMgr=null;this.fileSrc=c;this.chmFile=d;this.zipFiles={};this.currentTileRequests=[];this.pendingTileRequests=[];this.initEventListeners(b);this.initTileWindows();this.tileCache=new O(this);this.source()!==h.FILE_SOURCE?(this.source()!==h.WEB_SOURCE&&createWebLoader(this.source()),N(this,e.addMapConfig,e.addMapData)):("undefined"===typeof embedDiv&&P(this),Q(this,e.addMapConfig,e.addMapData))}function R(a){function b(d,e,g){c.hasOwnProperty(d)?
a.datalevels[d]=new S(a.tileCache,d,c[d],e?a.datalevels[e]:null):g&&(a.datalevels[d]=a.datalevels[g],a.alternateLevels.hasOwnProperty(g)||(a.alternateLevels[g]=[]),a.alternateLevels[g].push(d))}const c=a.mapConfig.data_configuration.map_information.levels;b(m.THUMBNAIL_LEVEL);b(m.SUMMARY_LEVEL,m.THUMBNAIL_LEVEL,m.THUMBNAIL_LEVEL);b(m.DETAIL_LEVEL,m.SUMMARY_LEVEL,m.SUMMARY_LEVEL);b(m.RIBBON_VERT_LEVEL,m.SUMMARY_LEVEL,m.DETAIL_LEVEL);b(m.RIBBON_HOR_LEVEL,m.SUMMARY_LEVEL,m.DETAIL_LEVEL);T(a);a.sendCallBack(h.Event_INITIALIZED)}
function T(a){a.thumbnailWindowRefs=Object.keys(a.mapConfig.data_configuration.map_information.data_layer).map(b=>a.getNewAccessWindow({layer:b,level:m.THUMBNAIL_LEVEL,firstRow:1,firstCol:1,numRows:a.getNumRows(m.THUMBNAIL_LEVEL),numCols:a.getNumColumns(m.THUMBNAIL_LEVEL)}))}function K(a,b){q.initMessageBox().classList.add("file-viewer");q.setMessageBoxHeader(a);q.setMessageBoxText(b);q.setMessageBoxButton("download",{type:"text",text:"Download Viewer"},"Download viewer button",()=>{h.zipAppDownload();
q.messageBoxCancel()});q.setMessageBoxButton("cancel",{type:"text",text:"Cancel",default:!0},"Cancel button",q.messageBoxCancel);q.displayMessageBox()}function P(a){function b(e,g){e=e.split(".").map(k=>k|0);g=g.split(".").map(k=>k|0);for(let k=0;;k++){if(k==e.length&&k==g.length)return!1;if(k==g.length)return!0;if(k==e.length)return!1;if(e[k]>g[k])return!0;if(e[k]<g[k])return!1}}const c=new XMLHttpRequest,d=C.version.replace(/-.*$/,"");c.open("GET",C.versionCheckUrl+d,!0);c.onreadystatechange=function(){if(c.readyState==
c.DONE)if(200!=c.status)console.log("Failed to get software version: "+c.status);else{const e=c.response;b(e,d)&&"undefined"===typeof NgChm.galaxy&&null===h.embeddedMapName&&a.source()!=h.WEB_SOURCE&&K("New NG-CHM File Viewer Version Available","<br>The version of the NG-CHM File Viewer application that you are running ("+C.version+") has been superceded by a newer version ("+e+"). You will be able to view all pre-existing heat maps with this new backward-compatible version. However, you may wish to download the latest version of the viewer.<br><br>The application downloads as a single HTML file (ngchmApp.html).  When the download completes, you may run the application by simply double-clicking on the downloaded file.  You may want to save this file to a location of your choice on your computer for future use.<br><br>")}};
c.send()}function Q(a,b,c){function d(e,g,k){g.getData(new zip.TextWriter,{}).then(l=>{k(e,JSON.parse(l))})}0===a.chmFile.size?q.mapLoadError(a.chmFile.name,"File is empty (zero bytes)"):(new zip.ZipReader(new zip.BlobReader(a.chmFile))).getEntries().then(function(e){if(0==e.length)q.mapLoadError(a.chmFile.name,"Empty zip file");else{var g=e[0].filename,k=g.indexOf("/");if(0>k)q.mapLoadError(a.chmFile.name,"File format not recognized");else{a.mapName=g.substring(0,k);for(g=0;g<e.length;g++)a.zipFiles[e[g].filename]=
e[g];var l=a.mapName+"/mapConfig.json",n=a.mapName+"/mapData.json";l in a.zipFiles&&n in a.zipFiles?(setTimeout(()=>{d(a,a.zipFiles[l],b)}),setTimeout(()=>{d(a,a.zipFiles[n],c)})):q.mapLoadError(a.chmFile.name,"Missing NGCHM content")}}}).catch(function(e){console.log("Zip file read error "+e);q.mapLoadError(a.chmFile.name,e)})}function U(a,b){const c=a.mapName+"/"+b.layer+"/"+b.level+"/"+b.tileName;let d=a.zipFiles[c+".tile"];"undefined"===typeof d&&(d=a.zipFiles[c+".bin"]);"undefined"===typeof d?
(console.error("Request for unknown zip tile: "+c),a.tileRequestComplete(b.tileCacheName,null)):setTimeout(function(){d.getData(new zip.BlobWriter).then(function(e){const g=new FileReader;g.onerror=function(){console.error("Error in zip file reader",g.error);a.tileRequestComplete(b.tileCacheName,null)};g.onload=function(k){k=new Float32Array(g.result);a.tileRequestComplete(b.tileCacheName,k)};g.readAsArrayBuffer(e)}).catch(e=>{console.error("Error getting zip tile data",e)})},1)}NgChm.markFile();
const h=NgChm.importNS("NgChm.MMGR"),I=NgChm.importNS("NgChm.UTIL"),L=NgChm.importNS("NgChm.FLICK"),m=NgChm.importNS("NgChm.MAPREP"),J=NgChm.importNS("NgChm.CFG"),D=NgChm.importNS("NgChm.CMM"),q=NgChm.importNS("NgChm.UHM"),C=NgChm.importNS("NgChm.CM");h.webLoader=null;h.WEB_SOURCE="W";h.LOCAL_SOURCE="L";h.FILE_SOURCE="F";h.Event_INITIALIZED="Init";h.Event_JSON="Json";h.Event_NEWDATA="NewData";h.embeddedMapName=null;h.localRepository="/NGCHM";h.isRow=v;class V{constructor(a,b){const {layer:c,level:d,
startRowTile:e,endRowTile:g,startColTile:k,endColTile:l}=b;var n=a.datalevels[d];(1>e||g>n.numTileRows||1>k||l>n.numTileColumns||g<e||l<k)&&console.error("Constructing TileWindow with out-of-range tiles",b,n);this.heatMap=a;this.layer=c;this.level=d;this.startRowTile=e;this.endRowTile=g;this.startColTile=k;this.endColTile=l;this.numColumnTiles=l-k+1;this.totalTiles=(g-e+1)*this.numColumnTiles;this.tiles=Array({length:this.totalTiles});this._allTilesAvailable=!0;a=0;for(b=this.startRowTile;b<=this.endRowTile;b++)for(n=
this.startColTile;n<=this.endColTile;n++)this.tiles[a]=this.heatMap.tileCache.getTileCacheData(this.layer+"."+this.level+"."+b+"."+n),this.tiles[a]||(this._allTilesAvailable=!1),a++;this.tileStatusValid=!0}myKey(){return[this.layer,this.level,this.startRowTile,this.endRowTile,this.startColTile,this.endColTile].join(".")}isTileInWindow(a){return a.layer===this.layer&&a.level===this.level&&a.row>=this.startRowTile&&a.row<=this.endRowTile&&a.col>=this.startColTile&&a.col<=this.endColTile}checkTile(a){a.hasOwnProperty("data")||
console.error("NEWDATA message has no data field",a);if(this.isTileInWindow(a)){const b=(a.row-this.startRowTile)*this.numColumnTiles+a.col-this.startColTile;b>=this.totalTiles&&console.error("Tile idx out of range",{idx:b,tile:a,tileWindow:this});this.tiles[b]=a.data;this.tileStatusValid=!1}}getTileData(a,b){if(a>=this.startRowTile&&a<=this.endRowTile&&b>=this.startColTile&&b<=this.endColTile)return this.tiles[(a-this.startRowTile)*this.numColumnTiles+b-this.startColTile];console.error("getTileData out of limits",
{tileRow:a,tileCol:b,tileWindow:this});return null}fetchTiles(){let a=0;for(let b=this.startRowTile;b<=this.endRowTile;b++)for(let c=this.startColTile;c<=this.endColTile;c++)this.tiles[a]||(this.tiles[a]=this.heatMap.tileCache.getTileCacheData(this.layer+"."+this.level+"."+b+"."+c),this.tiles[a]||(this.tiles[a]=this.heatMap.tileCache.getTile(this.layer,this.level,b,c))),a++}allTilesAvailable(){if(this.tileStatusValid)return this._allTilesAvailable;for(let a=0;a<this.totalTiles;a++)if(!this.tiles[a])return this._allTilesAvailable=
!1,this.tileStatusValid=!0,!1;return this.tileStatusValid=this._allTilesAvailable=!0}onready(a){const b=this,c=new Promise((d,e)=>{function g(k,l){return l.layer==k.layer&&l.level==k.level&&k.allTilesAvailable()?(d(k),!0):!1}b.allTilesAvailable()?d(b):b.heatMap.tileWindowListeners.push({tileWindow:b,checkReady:g})});if(a)c.then(a);else return c}}class O{constructor(a){this.heatMap=a;this.cacheEntries={};this.longestLoadTime=0}createTileCacheEntry(a){const [b,c,d,e]=a.split(".");return this.cacheEntries[a]=
{props:{layer:b,level:c,row:d|0,col:e|0},data:null,fetchTime:0,loadTime:0,fetches:0,failedFetches:0,dataSize:0}}haveTileData(a){return null!=this.getTileCacheData(a)}getTile(a,b,c,d){const e=a+"."+b+"."+c+"."+d;let g=!0,k=this.cacheEntries[e];if(k){const l=this.getEntryData(e,k);if(l)return l;0<k.fetchTime&&(performance.now()-k.fetchTime<Math.max(3E3,1.25*this.longestLoadTime)?g=!1:k.failedFetches++)}else k=this.createTileCacheEntry(e);g&&(k.fetches++,k.fetchTime=performance.now());this.heatMap.loadHeatMapTile({tileCacheName:e,
layer:a,level:b,tileName:b+"."+c+"."+d});return null}showTileCacheStats(){for(let a in this.cacheEntries){const b=this.cacheEntries[a];if(b.data){const c=b.loadTime-b.fetchTime;console.log({tileCacheName:a,fetches:b.fetches,KBytes:b.dataSize/1024,loadTime:c,loadTimePerKByte:c/b.dataSize*1024})}}console.log("Longest load time: "+this.longestLoadTime)}resetTileCacheEntry(a){const b=this.cacheEntries[a];b&&(a=this.getEntryData(a,b),b.fetchTime=0,a||b.failedFetches++)}getTileCacheData(a){const b=this.cacheEntries[a];
return b?this.getEntryData(a,b):null}getEntryData(a,b){if(null===b.data)return null;a=b.data.deref();null==a&&(b.data=null);return a}setTileCacheEntry(a,b){a=this.cacheEntries[a];a.loadTime=performance.now();const c=a.loadTime-a.fetchTime;c>this.longestLoadTime&&(this.longestLoadTime=c);a.data=new WeakRef(b);a.dataSize=b.length;this.heatMap.updateTileWindows(Object.assign({},a.props,{data:b}))}}class W{constructor(a,b){this.heatMap=a;this.win={layer:b.layer,level:b.level,firstRow:b.firstRow|0,firstCol:b.firstCol|
0,numRows:b.numRows|0,numCols:b.numCols|0};this.tileWindow=a.getTileWindow(this.win);this.tileWindow.fetchTiles();this.datalevel=a.datalevels[this.win.level]}getValue(a,b){return this.datalevel.getLayerValue(this.win.layer,this.tileWindow,a|0,b|0)}getRowValues(a,b,c){b||(b=this.win.firstCol);c||(c=this.win.firstCol+this.win.numCols-b);return this.datalevel.getRowValues(this.tileWindow,a,b,c)}allTilesAvailable(){return this.tileWindow.allTilesAvailable()}onready(a){const b=this.tileWindow.onready();
if(a)b.then(()=>a(this));else return b.then(()=>this)}isTileInWindow(a){return this.tileWindow.isTileInWindow(a)}}f.prototype.setCurrentDL=function(a){this._currentDl!=a&&(this._currentDl=a,this.setSelectionColors())};f.prototype.getCurrentDL=function(a){return this._currentDl};f.prototype.getCurrentColorMap=function(){return this.getColorMapManager().getColorMap("data",this.getCurrentDL())};f.prototype.setSelectionColors=function(){var a=this.getColorMapManager().getColorMap("data",this._currentDl);
const b=this.getDataLayers()[this._currentDl];var c=D.hexToRgba(b.selection_color);a=a.isColorDark(c)?"#000000":"#FFFFFF";c=document.documentElement;c.style.setProperty("--in-selection-color",a);c.style.setProperty("--in-selection-background-color",b.selection_color)};f.prototype.getMapConfig=function(){return this.mapConfig};f.prototype.isMapLoaded=function(){return null!==this.mapConfig};f.prototype.isFileMode=function(){return this.source()===h.FILE_SOURCE};f.prototype.isReadOnly=function(){return"Y"===
this.mapConfig.data_configuration.map_information.read_only};f.prototype.getAxisConfig=function(a){return v(a)?this.getRowConfig():this.getColConfig()};f.prototype.getRowConfig=function(){return this.mapConfig.row_configuration};f.prototype.getColConfig=function(){return this.mapConfig.col_configuration};f.prototype.getAxisCovariateConfig=function(a){return this.getAxisConfig(a).classifications};f.prototype.getAxisCovariateOrder=function(a){return v(a)?this.getRowClassificationOrder():this.getColClassificationOrder()};
f.prototype.getRowClassificationConfig=function(){return this.mapConfig.row_configuration.classifications};f.prototype.getRowClassificationConfigOrder=function(){return this.mapConfig.row_configuration.classifications_order};f.prototype.getColClassificationConfig=function(){return this.mapConfig.col_configuration.classifications};f.prototype.getColClassificationConfigOrder=function(){return this.mapConfig.col_configuration.classifications_order};f.prototype.getCovariateBarTypes=function(a){return Object.entries(this.getAxisCovariateConfig(a)).map(([,
b])=>"Y"===b.show?b.bar_type:0)};f.prototype.getCovariateBarParams=function(a){return Object.entries(this.getAxisCovariateConfig(a)).map(([,b])=>{b="Y"===b.show?"color_plot"==b.bar_type?{color_map:b.color_map}:{bg_color:b.bg_color,fg_color:b.fg_color,low_bound:b.low_bound,high_bound:b.high_bound}:{};return b})};f.prototype.getRowClassificationOrder=function(a){var b=this.mapConfig.row_configuration.classifications_order;if("undefined"===typeof b)for(key in b=[],this.mapConfig.row_configuration.classifications)b.push(key);
if("undefined"===typeof a)return b;a=[];for(var c=0;c<b.length;c++){var d=b[c];"Y"==this.mapConfig.row_configuration.classifications[d].show&&a.push(d)}return a};f.prototype.setRowClassificationOrder=function(){null!==this.mapConfig&&(this.mapConfig.row_configuration.classifications_order=this.getRowClassificationOrder())};f.prototype.getColClassificationOrder=function(a){var b=this.mapConfig.col_configuration.classifications_order;if("undefined"===typeof b)for(key in b=[],this.mapConfig.col_configuration.classifications)b.push(key);
if("undefined"===typeof a)return b;a=[];for(var c=0;c<b.length;c++){var d=b[c];"Y"==this.mapConfig.col_configuration.classifications[d].show&&a.push(d)}return a};const X={r:0,g:0,b:0,a:0},Y=D.hexToRgba("#FFFFFF");class Z{constructor(a,b,c,d){Object.assign(this,c,{idx:b,label:a,height:c.height*d|0})}getScatterBarPlotColors(){const a=D.hexToRgba(this.fg_color);return["#FFFFFF"===this.subBgColor?X:D.hexToRgba(this.bg_color),a,Y]}}f.prototype.getScaledVisibleCovariates=function(a,b){const c=v(a)?this.mapConfig.row_configuration:
this.mapConfig.col_configuration;a=(c.hasOwnProperty("classifications_order")?c.classifications_order:Object.keys(c.classifications)).map((d,e)=>new Z(d,e,c.classifications[d],b)).filter(d=>"Y"===d.show);Object.defineProperty(a,"totalHeight",{value:function(){return this.map(d=>d.height).reduce((d,e)=>d+e,0)},enumerable:!1});Object.defineProperty(a,"containsLegend",{value:function(){return 0<this.filter(d=>"color_plot"!==d.bar_type).length},enumerable:!1});return a};f.prototype.hasHiddenCovariates=
function(a){const b=v(a)?this.mapConfig.row_configuration:this.mapConfig.col_configuration;return 0<(b.hasOwnProperty("classifications_order")?b.classifications_order:Object.keys(b.classifications)).map(c=>b.classifications[c].show).filter(c=>"Y"!==c).length};f.prototype.setColClassificationOrder=function(){null!==this.mapConfig&&(this.mapConfig.col_configuration.classifications_order=this.getColClassificationOrder())};f.prototype.getMapInformation=function(){return this.mapConfig.data_configuration.map_information};
f.prototype.getDataLayers=function(){return this.mapConfig.data_configuration.map_information.data_layer};f.prototype.getCurrentDataLayer=function(){return this.getDataLayers()[this.getCurrentDL()]};f.prototype.getDividerPref=function(){return this.mapConfig.data_configuration.map_information.summary_width};f.prototype.setDividerPref=function(a){if(void 0===a){a=document.getElementById("ngChmContainer");var b=document.getElementById("summary_chm");a=Math.ceil(100*b.clientWidth/a.clientWidth)}this.mapConfig.data_configuration.map_information.summary_width=
a;this.mapConfig.data_configuration.map_information.detail_width=100-a};f.prototype.setClassificationPrefs=function(a,b,c,d){v(b)?(this.mapConfig.row_configuration.classifications[a].show=c?"Y":"N",this.mapConfig.row_configuration.classifications[a].height=parseInt(d)):(this.mapConfig.col_configuration.classifications[a].show=c?"Y":"N",this.mapConfig.col_configuration.classifications[a].height=parseInt(d))};f.prototype.setClassBarScatterPrefs=function(a,b,c,d,e,g,k){v(b)?(this.mapConfig.row_configuration.classifications[a].bar_type=
c,"undefined"!==typeof d&&(this.mapConfig.row_configuration.classifications[a].low_bound=d,this.mapConfig.row_configuration.classifications[a].high_bound=e,this.mapConfig.row_configuration.classifications[a].fg_color=g,this.mapConfig.row_configuration.classifications[a].bg_color=k)):(this.mapConfig.col_configuration.classifications[a].bar_type=c,"undefined"!==typeof d&&(this.mapConfig.col_configuration.classifications[a].low_bound=d,this.mapConfig.col_configuration.classifications[a].high_bound=e,
this.mapConfig.col_configuration.classifications[a].fg_color=g,this.mapConfig.col_configuration.classifications[a].bg_color=k))};f.prototype.setLayerGridPrefs=function(a,b,c,d,e){this.mapConfig.data_configuration.map_information.data_layer[a].grid_show=b?"Y":"N";this.mapConfig.data_configuration.map_information.data_layer[a].grid_color=c;this.mapConfig.data_configuration.map_information.data_layer[a].cuts_color=e;this.mapConfig.data_configuration.map_information.data_layer[a].selection_color=d;a==
this.getCurrentDL()&&this.setSelectionColors()};f.prototype.getRowOrganization=function(){return this.mapConfig.row_configuration.organization};f.prototype.getColOrganization=function(){return this.mapConfig.col_configuration.organization};f.prototype.getMapInformation=function(){return this.mapConfig.data_configuration.map_information};f.prototype.getPanelConfiguration=function(){return this.mapConfig.panel_configuration};f.prototype.getRowDendroConfig=function(){return this.mapConfig.row_configuration.dendrogram};
f.prototype.getColDendroConfig=function(){return this.mapConfig.col_configuration.dendrogram};f.prototype.setRowDendrogramShow=function(a){this.mapConfig.row_configuration.dendrogram.show=a};f.prototype.setColDendrogramShow=function(a){this.mapConfig.col_configuration.dendrogram.show=a};f.prototype.setRowDendrogramHeight=function(a){this.mapConfig.row_configuration.dendrogram.height=a};f.prototype.setColDendrogramHeight=function(a){this.mapConfig.col_configuration.dendrogram.col_dendro_height=a};
f.prototype.showRowDendrogram=function(a){var b=!0,c=this.mapConfig.row_configuration.dendrogram.show;if("NONE"===c||"NA"===c)b=!1;"DETAIL"===a&&"SUMMARY"===c&&(b=!1);return b};f.prototype.showColDendrogram=function(a){var b=!0,c=this.mapConfig.col_configuration.dendrogram.show;if("NONE"===c||"NA"===c)b=!1;"DETAIL"===a&&"SUMMARY"===c&&(b=!1);return b};f.prototype.setReadOnly=function(){this.mapConfig.data_configuration.map_information.read_only="Y"};f.prototype.saveDataSentToPluginToMapConfig=function(a,
b,c){try{var d=document.querySelectorAll('[data-nonce="'+a+'"]')[0].parentElement.parentElement}catch(e){throw"Cannot determine pane for given nonce";}a=d.id;this.mapConfig.hasOwnProperty("panel_configuration")||(this.mapConfig.panel_configuration={});this.mapConfig.panel_configuration.hasOwnProperty(a)&&null!=this.mapConfig.panel_configuration[a]||(this.mapConfig.panel_configuration[a]={});b&&(this.mapConfig.panel_configuration[a].config=b);c&&(this.mapConfig.panel_configuration[a].data=c);this.mapConfig.panel_configuration[a].type=
"plugin";this.mapConfig.panel_configuration[a].pluginName=d.dataset.pluginName};f.prototype.removePaneInfoFromMapConfig=function(a){this.mapConfig.hasOwnProperty("panel_configuration")&&(this.mapConfig.panel_configuration[a]=null)};f.prototype.saveLinkoutPaneToMapConfig=function(a,b,c){this.mapConfig.hasOwnProperty("panel_configuration")||(this.mapConfig.panel_configuration={});this.mapConfig.panel_configuration[a]={type:"linkout",url:b,paneTitle:c}};f.prototype.saveDataFromPluginToMapConfig=function(a,
b){try{var c=document.querySelectorAll('[data-nonce="'+a+'"]')[0].parentElement.parentElement.id}catch(d){throw"Cannot determine pane for given nonce";}this.mapConfig.hasOwnProperty("panel_configuration")||(this.mapConfig.panel_configuration={});this.mapConfig.panel_configuration.hasOwnProperty(c)&&null!=this.mapConfig.panel_configuration[c]||(this.mapConfig.panel_configuration[c]={});this.mapConfig.panel_configuration[c].dataFromPlugin=b};f.prototype.getAxisCovariateData=function(a){return v(a)?
this.mapData.row_data.classifications:this.mapData.col_data.classifications};f.prototype.getRowClassificationData=function(){return this.mapData.row_data.classifications};f.prototype.getColClassificationData=function(){return this.mapData.col_data.classifications};f.prototype.getAxisLabels=function(a){return v(a)?this.mapData.row_data.label:this.mapData.col_data.label};f.prototype.getRowLabels=function(){return this.mapData.row_data.label};f.prototype.getColLabels=function(){return this.mapData.col_data.label};
f.prototype.getDendrogramData=function(a){return((v(a)?this.mapData.row_data.dendrogram:this.mapData.col_data.dendrogram)||[]).map(b=>{b=b.split(",");return{left:Number(b[0]),right:Number(b[1]),height:Number(b[2])}})};f.prototype.getTotalRows=function(){return this.datalevels[m.DETAIL_LEVEL].totalRows};f.prototype.getSummaryRowRatio=function(){return null!==this.datalevels[m.SUMMARY_LEVEL]?this.datalevels[m.SUMMARY_LEVEL].rowSummaryRatio:this.datalevels[m.THUMBNAIL_LEVEL].rowSummaryRatio};f.prototype.getSummaryColRatio=
function(){return null!==this.datalevels[m.SUMMARY_LEVEL]?this.datalevels[m.SUMMARY_LEVEL].colSummaryRatio:this.datalevels[m.THUMBNAIL_LEVEL].col_summaryRatio};f.prototype.getTotalRows=function(){return this.datalevels[m.DETAIL_LEVEL].totalRows};f.prototype.getTotalCols=function(){return this.datalevels[m.DETAIL_LEVEL].totalColumns};f.prototype.getTotalElementsForAxis=function(a){const b=this.datalevels[m.DETAIL_LEVEL];return v(a)?b.totalRows:b.totalColumns};f.prototype.getNumRows=function(a){return this.datalevels[a].totalRows};
f.prototype.getNumColumns=function(a){return this.datalevels[a].totalColumns};f.prototype.getRowSummaryRatio=function(a){return this.datalevels[a].rowSummaryRatio};f.prototype.getColSummaryRatio=function(a){return this.datalevels[a].colSummaryRatio};f.prototype.getValue=function(a,b,c){return this.getNewAccessWindow({layer:this._currentDl,level:a,firstRow:b,firstCol:c,numRows:1,numCols:1}).getValue(b,c)};f.prototype.getAllAlternateLevels=function(a){function b(d){d=c.hasOwnProperty(d)?c[d]:[];const e=
d.map(g=>b(g));return[...(new Set(e.concat(d).flat()))]}const c=this.alternateLevels;return b(a)};Object.assign(f.prototype,{initEventListeners:function(a){this.eventListeners=a.slice(0)},addEventListener:function(a){this.eventListeners.push(a.bind(this))},sendAllListeners:function(a,b){this.eventListeners.forEach(c=>c(a,b));if(a===h.Event_NEWDATA){const {layer:c,level:d,row:e,col:g,data:k}=b,l=this.getAllAlternateLevels(d);for(;0<l.length;){const n={layer:c,level:l.shift(),row:e,col:g,data:k};this.eventListeners.forEach(p=>
p(a,n))}}}});f.prototype.getColorMapManager=function(){if(null==this.mapConfig)return null;null==this.colorMapMgr&&(this.colorMapMgr=new D.ColorMapManager(this));return this.colorMapMgr};f.prototype.initTileWindows=function(){this.tileWindowListeners=[];this.tileWindowRefs=new Map};f.prototype.updateTileWindows=function(a){this.tileWindowRefs.forEach((c,d)=>{(c=c.deref())?c.checkTile(a):this.tileWindowRefs.delete(d)});let b=0;for(;b<this.tileWindowListeners.length;){const c=this.tileWindowListeners[b];
c.checkReady(c.tileWindow,a)?this.tileWindowListeners.splice(b,1):b++}this.sendCallBack(h.Event_NEWDATA,a)};f.prototype.tileIdReferenced=function(a){const [b,c,d,e]=a.split(".");var g=!1;this.tileWindowRefs.forEach((k,l)=>{const [n,p,r,z,A,w]=l.split(".");n==b&&p==c&&(d|0)>=(r|0)&&(d|0)<=(z|0)&&(e|0)>=(A|0)&&(e|0)<=(w|0)&&(g=!0)});return g};f.prototype.hasGaps=function(){return 0!=this.getMapInformation().map_cut_rows+this.getMapInformation().map_cut_cols};f.prototype.source=function(){return this.fileSrc};
f.prototype.setUnAppliedChanges=function(a){this.unAppliedChanges=a};f.prototype.getUnAppliedChanges=function(){return this.unAppliedChanges};f.prototype.sendCallBack=function(a,b){if(a===h.Event_INITIALIZED||a===h.Event_JSON||a===h.Event_NEWDATA&&b.level===m.THUMBNAIL_LEVEL){null!=this.mapData&&null!=this.mapConfig&&0<Object.keys(this.datalevels).length&&this.tileCache.haveTileData(this.getCurrentDL()+"."+m.THUMBNAIL_LEVEL+".1.1")&&!this.initialized&&(this.initialized=!0,this.source()!==h.LOCAL_SOURCE&&
(document.title=this.getMapInformation().name),document.getElementById("mapName").innerHTML=this.getMapInformation().name,this.mapConfig.hasOwnProperty("panel_configuration")||I.hideLoader(!0),this.sendAllListeners(h.Event_INITIALIZED));const c=this.tileCache.getTileCacheData(this.getCurrentDL()+"."+m.SUMMARY_LEVEL+".1.1");c&&this.sendAllListeners(h.Event_NEWDATA,{layer:this.getCurrentDL(),level:m.SUMMARY_LEVEL,row:1,col:1,data:c})}a===h.Event_NEWDATA&&this.initialized&&this.sendAllListeners(a,b)};
f.prototype.getNewTileWindow=function(a){const b=[a.layer,a.level,a.startRowTile,a.endRowTile,a.startColTile,a.endColTile].join(".");if(this.tileWindowRefs.has(b)){const c=this.tileWindowRefs.get(b).deref();if(c)return c}a=new V(this,a);this.tileWindowRefs.set(b,new WeakRef(a));return a};f.prototype.getTileWindow=function(a){return this.datalevels[a.level].getTileAccessWindow(a.layer,a.firstRow,a.firstCol,a.numRows,a.numCols,b=>this.getNewTileWindow(b))};f.prototype.getNewAccessWindow=function(a){return new W(this,
a)};f.prototype.getSummaryHist=function(a,b,c){c-=b;const d=Array(11).join("0").split("").map(parseFloat),e=Array(10).join("0").split("").map(parseFloat);for(let l=0;l<e.length;l++)e[l]+=b+c/(e.length-1)*l;b=F.getNumColumns(m.SUMMARY_LEVEL);const g=F.getNumRows(m.SUMMARY_LEVEL),k=this.getNewAccessWindow({layer:a,level:m.SUMMARY_LEVEL,firstRow:1,firstCol:1,numRows:g,numCols:b});return k.onready().then(l=>{l=0;for(var n=1;n<=g;n++)for(var {value:p}of k.getRowValues(n))if(isNaN(p)||p>=m.maxValues)l++;
else if(p>m.minValues){for(var r=0;r<e.length&&p>=e[r];)r++;d[r]++}p=0;n=l;for(r=0;r<d.length;r++)d[r]>n&&(n=d[r]),p+=d[r];return{breaks:e,bins:d,binMax:n,total:p,nan:l}})};class S{constructor(a,b,c,d){this.tileCache=a;this.level=b;this.totalRows=c.total_rows;this.totalColumns=c.total_cols;this.numTileRows=c.tile_rows;this.numTileColumns=c.tile_cols;this.rowsPerTile=c.rows_per_tile;this.colsPerTile=c.cols_per_tile;this.rowSummaryRatio=c.row_summary_ratio;this.colSummaryRatio=c.col_summary_ratio;this.lowerLevel=
d;this.rowToLower=null===d?null:this.totalRows/d.totalRows;this.colToLower=null===d?null:this.totalColumns/d.totalColumns;this.lastTileWindow=null;this.isLineACut=Array(this.totalRows);this.colsInLastTile=this.totalColumns%this.colsPerTile;0==this.colsInLastTile&&(this.colsInLastTile=this.colsPerTile);this.rowsInLastTile=this.totalRows%this.rowsPerTile;0==this.rowsInLastTile&&(this.rowsInLastTile=this.rowsPerTile)}numRowsInTile(a){return a<this.numTileRows?this.rowsPerTile:this.rowsInLastTile}numColsInTile(a){return a<
this.numTileColumns?this.colsPerTile:this.colsInLastTile}getLayerValue(a,b,c,d){const e=Math.floor((c-1)/this.rowsPerTile)+1,g=Math.floor((d-1)/this.colsPerTile)+1;!b&&this.lastTileWindow&&this.lastTileWindow.layer==a&&e>=this.lastTileWindow.startRowTile&&e<=this.lastTileWindow.endRowTile&&g>=this.lastTileWindow.startColTile&&g<=this.lastTileWindow.endColTile?b=this.lastTileWindow:b||(this.lastTileWindow=b=this.tileCache.heatMap.getNewTileWindow({layer:a,level:this.level,startRowTile:e,endRowTile:this.numTileRows,
startColTile:1,endColTile:this.numTileColumns}));return(b=b.getTileData(e,g))?(a=this.numColsInTile(g),b[(c-1)%this.rowsPerTile*a+(d-1)%this.colsPerTile]):null!=this.lowerLevel?this.lowerLevel.getLayerValue(a,null,Math.floor((c-1)/this.rowToLower)+1,Math.floor((d-1)/this.colToLower)+1):0}getRowValues(a,b,c,d){const e=a.layer;b|=0;c|=0;const g=Math.floor((b-1)/this.rowsPerTile)+1,k=(b-1)%this.rowsPerTile,l={},n=this,p=this.lowerLevel,r=this.colsPerTile,z=((b-1)/this.rowToLower|0)+1,A=this.colToLower,
w=1/this.colToLower;l[Symbol.iterator]=function*(){for(let y=0;y<d;){var t=((c+y-1)/r|0)+1,B=n.numColsInTile(t),u=a.getTileData(g,t);t=Math.min(t*r-c-y+1,d-y);let x=y;if(u){B=k*B+(c+y-1)%r;for(let E=0;E<t;E++)yield{i:x,col:c+x,value:u[B+E]},x++}else if(p){u=((c+y-1)*w|0)+1;B=p.tileCache.heatMap.getNewAccessWindow({layer:e,level:p.level,firstRow:z,firstCol:u,numRows:1,numCols:((c+y+t-2)*w|0)+1-u+1}).getRowValues(z);u=0;for(let {i:E,value:aa}of B)for(B=Math.min((E+1)*A|0,t);u<B;)yield{i:x,col:c+x,value:aa},
x++,u++;for(;u<t;)yield{i:u,col:c+x,value:0},u++}else for(u=0;u<t;u++)yield{i:x,col:c+x,value:0},x++;y+=t}};return l}getTileAccessWindow(a,b,c,d,e,g){return g({layer:a,level:this.level,startRowTile:Math.floor((b-1)/this.rowsPerTile)+1,endRowTile:Math.ceil((b+d-1)/this.rowsPerTile),startColTile:Math.floor((c-1)/this.colsPerTile)+1,endColTile:Math.ceil((c+e-1)/this.colsPerTile)})}}(function(){var a,b,c;h.initAxisLabels=function(){a={};b={ROW:[],COLUMN:[]};c={ROW:{},COLUMN:{}}};h.initAxisLabels();h.getActualLabels=
function(d){d=h.isRow(d)?"ROW":"COLUMN";if(!a.hasOwnProperty(d)){const e=h.getHeatMap().getAxisLabels(d).labels;a[d]=e.map(g=>void 0===g?void 0:g.split("|")[0])}return a[d]};h.getShownLabels=function(d){d=h.isRow(d)?"ROW":"COLUMN";var e=h.getHeatMap().getAxisConfig(d);if(c[d].label_display_length!==e.label_display_length||c[d].label_display_method!==e.label_display_method)c[d].label_display_length=e.label_display_length,c[d].label_display_method=e.label_display_method,e=h.getActualLabels(d),b[d]=
e.map(g=>void 0===g?"":h.getLabelText(g,d));return b[d]}})();h.getLabelText=function(a,b,c){const d=h.getHeatMap();var e=parseInt(d.getColConfig().label_display_length),g=d.getColConfig().label_display_method;"ROW"===b.toUpperCase()&&(e=parseInt(d.getRowConfig().label_display_length),g=d.getRowConfig().label_display_method);"undefined"!==typeof c&&(e=16);a.length>e&&(a="END"===g?a.substr(0,e-3)+"...":"MIDDLE"===g?a.substr(0,e/2-1)+"..."+a.substr(a.length-(e/2-2),a.length):"..."+a.substr(a.length-
(e-3),a.length));return a};h.zipAppDownload=function(){const a=h.getHeatMap();"undefined"!==typeof NgChm.galaxy?window.open("/plugins/visualizations/mda_heatmap_viz/static/ngChmApp.zip"):a&&a.source()!==h.FILE_SOURCE?H("GET",J.api+"ZipAppDownload",!1):H("GET",C.viewerAppUrl,!1)};h.showDownloadViewerNotification=K;f.prototype.loadHeatMapTile=function(a){var b=a.tileCacheName;this.tileCache.getTileCacheData(b)||this.currentTileRequests.includes(b)||(b=this.pendingTileRequests.map(c=>c.tileCacheName).indexOf(b),
0<=b&&this.pendingTileRequests.splice(b,1),this.pendingTileRequests.push(a),10<this.currentTileRequests.length||this.submitFirstPendingTileRequest())};f.prototype.tileRequestComplete=function(a,b){const c=this.currentTileRequests.indexOf(a);0>c?console.error("Tile has disappeared from currentTileRequests",{tileCacheName:a,currentTileRequests:this.currentTileRequests}):(this.currentTileRequests.splice(c,1),this.submitFirstPendingTileRequest());b?this.tileCache.setTileCacheEntry(a,b):this.tileCache.resetTileCacheEntry(a)};
f.prototype.submitFirstPendingTileRequest=function(){let a=0==this.pendingTileRequests.length?null:this.pendingTileRequests.pop();for(;a&&!this.tileIdReferenced(a.tileCacheName);)a=0==this.pendingTileRequests.length?null:this.pendingTileRequests.pop();a&&(this.currentTileRequests.push(a.tileCacheName),this.source()==h.WEB_SOURCE||this.source()==h.LOCAL_SOURCE?h.webLoader.postMessage({op:"loadTile",job:a}):U(this,a))};h.zipSaveMapProperties=function(a,b,c){function d(e){function g(n){return n.getData(new zip.TextWriter).then(p=>
l(n.filename,p))}function k(n){return n.getData(new zip.BlobWriter).then(p=>e.add(n.filename,new zip.BlobReader(p)))}function l(n,p){return e.add(n,new zip.TextReader(p))}return new Promise((n,p)=>{function r(A){var w=(1+A)/(1+z.length);c&&(c(w)||p("Cancelled by user"));if(A==z.length)n(e);else{w=z[A];const t=a.zipFiles[w];(0<=w.indexOf("bin")||0<=w.indexOf("tile")?k(t):0<=w.indexOf("mapConfig")?l(t.filename,JSON.stringify(b||a.mapConfig)):g(t)).then(()=>r(A+1))}}const z=Object.keys(a.zipFiles);r(0)})}
return(new Promise((e,g)=>{e(new zip.ZipWriter(new zip.BlobWriter))})).then(e=>d(e)).then(e=>e.close()).then(e=>{saveAs(e,a.mapName+".ngchm");return!0}).catch(e=>{if("Cancelled by user"!=e){const g=q.newMessageBox("error-saving-ngchm");g.style.width="20em";q.setNewMessageBoxHeader(g,"Failed to save NG-CHM");q.getNewMessageTextBox(g).innerHTML="<P><B>The NG-CHM was not saved.</B></P><P>The following error details were recorded:</P><P><B>"+e+"</B></P>";q.setNewMessageBoxButton(g,"close",{type:"text",
text:"Close",tooltip:"Closes this dialog",default:!0});q.displayNewMessageBox(g)}return!1})};h.webSaveMapProperties=function(a){const b=JSON.stringify(a.getMapConfig());var c="false",d=new XMLHttpRequest;d.open("POST",J.api+"SaveMapProperties?map="+a.mapName,!1);d.setRequestHeader("Content-Type","application/json");d.onreadystatechange=function(){d.readyState==d.DONE&&(200!=d.status?(console.log("Failed in call to save propeties from server: "+d.status),c="false"):c=d.response)};d.send(b);return c};
h.zipMapProperties=function(a,b){H("POST",J.api+"ZippedMap?map="+a.mapName,b);return!0};var F=null,M=new WeakMap;const da={addMapConfig:ba,addMapData:ca};function G(a){let b=M.get(a);b||(b={mapUpdatedOnLoad:!1,flickInitialized:!1},M.set(a,b));return b}function ca(a,b){a.mapData=b;C.mapDataCompatibility(a.mapData)&&(G(a).mapUpdatedOnLoad=!0);a.sendCallBack(h.Event_JSON)}function ba(a,b){C.CompatibilityManager(b)&&(G(a).mapUpdatedOnLoad=!0);a.mapConfig=b;R(a);b=G(a);if(!b.flickInitialized){const g=
a.getDataLayers();var c=Object.keys(g).length;if(1<c){var d=Array(c);c=Array(c);for(var e in g){const k=+e.substring(2,e.length);c[k-1]=e;let l=g[e].name;20<l.length&&(l=l.substring(0,17)+"...");d[k-1]='<option value="'+e+'">'+l+"</option>"}e=(e=a.getPanelConfiguration())&&e.flickInfo?e.flickInfo:{};d=L.enableFlicks(c,d.join(""),e);a.setCurrentDL(d)}else a.setCurrentDL("dl1"),L.disableFlicks();b.flickInitialized=!0}a.sendCallBack(h.Event_JSON)}h.mapUpdatedOnLoad=function(a){return G(a).mapUpdatedOnLoad};
h.createHeatMap=function(a,b,c,d){F=new f(b,c,a,d,da)};h.getHeatMap=function(){return F};null!==h.embeddedMapName||""===I.mapId&&""===I.mapNameRef||h.createWebLoader(h.WEB_SOURCE);document.getElementById("mapName").addEventListener("mouseover",a=>{const b=h.getHeatMap();q.hlp(a.target,"Map Name: "+(null!==b?b.getMapInformation().name:"Not yet available")+"<br><br>Description: "+(null!==b?b.getMapInformation().description:"N/A"),350)},{passive:!0})})();
(function(){NgChm.markFile();const q=NgChm.createNS("NgChm.DDR");NgChm.importNS("NgChm.MAPREP");NgChm.importNS("NgChm.MMGR");q.maxDendroHeight=3E3;q.minDendroHeight=500;q.minDendroWidth=500;q.Dendrogram=function(g){this.bars=[];this.dendroCanvas=g;this.getDivWidth=function(){return this.dendroCanvas.clientWidth+2*("Row"===this.axis)};this.getDivHeight=function(){return this.dendroCanvas.clientHeight+2*("Column"===this.axis)};this.getConfigSize=function(){return this.dendroConfig.height/q.minDendroHeight};
this.checkDendroHit=function(b,c,d){function a(k,e,n,p,r){e<=l&&n<=h&&(k=e*e+n*n,k<f&&(f=k,m=this.getLocalBarIndex(p,r)))}const h=this.dendroViewHeight/20,l=this.dendroViewWidth/60;let f=1E10,m=-1;for(let k=0;k<this.bars.length;k++){const e=this.bars[k];let n=c<e.left?e.left-c:c>e.right?c-e.right:0,p=Math.abs(b-e.height);a.call(this,"b",n,p,-1,k);n=Math.abs(c-e.left);p=b<e.leftBot?e.leftBot-b:b>e.height?b-e.height:0;a.call(this,"l",n,p,this.dendroData[e.idx].left-1,k);n=Math.abs(c-e.right);p=b<e.rightBot?
e.rightBot-b:b>e.height?b-e.height:0;a.call(this,"r",n,p,this.dendroData[e.idx].right-1,k)}-1!==m&&d(m)};this.setCanvasSize=function(b,c){this.dendroCanvas.width=b;this.dendroCanvas.height=c};this.timeout=null;this.drawView=function(){null==this.timeout&&this.debouncedDraw&&setTimeout(()=>{this.debouncedDraw();this.timeout=null})}};q.ColumnDendrogram=function(){this.axis="Column";this.canvasEventPosn=function(g){return{w:event.offsetX/this.dendroCanvas.clientWidth,h:(this.dendroCanvas.clientHeight-
event.offsetY)/this.dendroCanvas.clientHeight}};this.drawPDF=function(g,b){function c(f){const m=a(f.left*l),k=a(f.right*l);var e=a(h-f.height*h);const n=a(f.leftBot*h);f=a(f.rightBot*h);0<=e&&e<h&&(d.moveTo(Math.max(0,m),e),d.lineTo(Math.min(l,k),e));e=Math.min(Math.max(0,e),h-1);0<=m&&m<l&&n<h&&(d.moveTo(m,e),d.lineTo(m,h-1-n));0<=k&&k<l&&f<h&&(d.moveTo(k,e),d.lineTo(k,h-1-f))}g.setDrawColor(0);const d=g.context2d;d.save();g.setLineCap("square");g.setLineJoin("square");const a=Math.floor,h=a(100*
b.height),l=a(100*b.width);d.translate(b.left,b.top);d.scale(.01,.01);g=this.getScaledView();b=g.filter(f=>1===f.thickness);0<b.length&&(d.beginPath(),d.lineWidth=0,b.forEach(c),d.stroke());g=g.filter(f=>2===f.thickness);0<g.length&&(d.beginPath(),d.lineWidth=100,g.forEach(c),d.stroke());d.restore()};this.debouncedDraw=function(){const g=Math.floor,b=this.dendroCanvas.getContext("2d"),c=this.dendroCanvas.height,d=this.dendroCanvas.width;b.fillStyle="black";b.imageSmoothingEnabled=!1;b.clearRect(0,
0,d,c);this.getScaledView().forEach(a=>{const h=g(a.left*d),l=g(a.right*d);var f=g(c-a.height*c);const m=g(a.leftBot*c),k=g(a.rightBot*c);if(f<c){const e=Math.max(0,h);b.fillRect(e,f,Math.min(d,l+1)-e,a.thickness)}f=Math.min(Math.floor(a.height*c),c);0<=h&&h<d&&m<c&&b.fillRect(h,c-f,a.thickness,f-m);0<=l&&l<d&&k<c&&b.fillRect(l,c-f,a.thickness,f-k)})}};q.RowDendrogram=function(){this.axis="Row";this.canvasEventPosn=function(g){return{w:event.offsetY/this.dendroCanvas.clientHeight,h:(this.dendroCanvas.clientWidth-
event.offsetX)/this.dendroCanvas.clientWidth}};this.drawPDF=function(g,b){function c(m){const k=d(m.left*h),e=d(m.right*h);var n=d(l-m.height*l);const p=d(m.leftBot*l);m=d(m.rightBot*l);0<=n&&n<l&&(a.moveTo(n,Math.max(0,k)),a.lineTo(n,Math.min(h,e)));n=Math.min(Math.max(0,n),l-1);0<=k&&k<h&&p<l&&(a.moveTo(n,k),a.lineTo(l-1-p,k));0<=e&&e<h&&m<l&&(a.moveTo(n,e),a.lineTo(l-1-m,e))}const d=Math.floor;g.setDrawColor(0);const a=g.context2d;a.save();g.setLineCap("square");g.setLineJoin("square");a.translate(b.left,
b.top);a.scale(.01,.01);const h=d(100*b.height),l=d(100*b.width);b=this.getScaledView();const f=b.filter(m=>1===m.thickness);0<f.length&&(a.beginPath(),g.setLineWidth(0),f.forEach(c),a.stroke());b=b.filter(m=>2===m.thickness);0<b.length&&(a.beginPath(),g.setLineWidth(100),b.forEach(c),a.stroke());a.restore()};this.debouncedDraw=function(){const g=Math.floor,b=this.dendroCanvas.getContext("2d"),c=this.dendroCanvas.width,d=this.dendroCanvas.height;b.fillStyle="black";b.imageSmoothingEnabled=!1;b.clearRect(0,
0,c,d);this.getScaledView().forEach(a=>{const h=g(a.left*d),l=g(a.right*d);var f=g(c-a.height*c);const m=g(a.leftBot*c),k=g(a.rightBot*c);f<c&&b.fillRect(f,Math.max(0,h),a.thickness,Math.min(d,l+1)-Math.max(0,h));f=Math.min(Math.floor(a.height*c),c);0<=h&&h<d&&m<c&&b.fillRect(c-f,h,f-m,a.thickness);0<=l&&l<d&&k<c&&b.fillRect(c-f,l,f-k,a.thickness)})}}})();
(function(){function p(a){let b=c.getGapItems(a);if(!b){let e=n.getHeatMap().getAxisLabels(a).labels;b={};e.forEach((d,f)=>{""==d&&(b[f+1]=!0)});c.setGapItems(a,b)}return b}NgChm.markFile();const c=NgChm.createNS("NgChm.SRCHSTATE"),n=NgChm.importNS("NgChm.MMGR"),g={Row:{},Column:{},RowCovar:{},ColumnCovar:{}};var k=new WeakMap;const m={},l={};c.getSearchSaveState=function(){const a={};a.row=c.getAxisSearchResults("Row");a.col=c.getAxisSearchResults("Column");return a};c.getGapItems=function(a){return a in
l?l[a]:null};c.getDiscCovState=function(a){return m[a]};c.getCurrentSearchItem=function(a){return k.get(a)||{}};c.getAxisSearchResults=function(a){n.isRow(a)&&(a="Row");"column"==a&&(a="Column");return Object.keys(g[a]).map(b=>+b)};c.getSearchResults=function(a){return g[a]};c.labelIndexInSearch=function(a,b){return null!=b&&null!=a&&1==g[a][b]};c.getSearchLabelsByAxis=function(a,b){let e=[];const d=n.getHeatMap(),f="Row"==a?d.getRowLabels().labels:"Column"==a?d.getColLabels().labels:"ColumnCovar"==
a?Object.keys(d.getColClassificationConfig()):"RowCovar"==a?Object.keys(d.getRowClassificationConfig()):[d.getRowLabels().labels,d.getColLabels().labels];c.getAxisSearchResults(a).forEach(h=>{a.includes("Covar")?b==linkouts.VISIBLE_LABELS?e.push(f[h].split("|")[0]):b==linkouts.HIDDEN_LABELS?e.push(f[h].split("|")[1]):e.push(f[h]):b==linkouts.VISIBLE_LABELS?e.push(f[h-1].split("|")[0]):b==linkouts.HIDDEN_LABELS?e.push(f[h-1].split("|")[1]):e.push(f[h-1])});return e};c.clearAllSearchResults=function(){g.Row=
{};g.Column={};g.RowCovar={};g.ColumnCovar={};k=new WeakMap;m.Row="";m.Column="";for(let a in l)delete l[a]};c.setGapItems=function(a,b){l[a]=b};c.setDiscCovState=function(a,b){m[a]=b};c.clearAllCurrentSearchItems=function(){k=new WeakMap};c.setSearchItem=function(a,b,e){let d=k.get(a);d||(d={},k.set(a,d));d.axis=b;d.index=e};c.setAxisSearchResults=function(a,b,e){const d=g[a];for(a=p(a);b<=e;b++)a[b]||(d[b]=1)};c.setAxisSearchResultsVec=function(a,b){const e=g[a],d=p(a);b.forEach(f=>{d[f]||(e[f]=
1)})};c.clearSearchRange=function(a,b,e){for(b=+b;b<+e+1;b++)delete g[a][b]};c.clearAllAxisSearchItems=function(a){g[a]={}}})();
